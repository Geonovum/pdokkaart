<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/**
<span class='line'>  2</span>  * @class Pdok.Api
<span class='line'>  3</span>  *
<span class='line'>  4</span>  * 
<span class='line'>  5</span>  * Class implements an API for an easy to use embedding of
<span class='line'>  6</span>  * our pre-defined mapservices in any website with an OpenLayers slippy map.
<span class='line'>  7</span>  * This class is based upon the Terrestris WMS-API
<span class='line'>  8</span>  * The markerstyles are based upon the Mapicons from Nicolas Mollet (http://mapicons.nicolasmollet.com)
<span class='line'>  9</span>  * 
<span class='line'> 10</span>  * @examples
<span class='line'> 11</span>  * 
<span class='line'> 12</span>  *  &lt;iframe width="400" height="300" frameborder="0" 
<span class='line'> 13</span>  *    scrolling="no" marginheight="0" marginwidth="0" 
<span class='line'> 14</span>  *    src="api/api.html?mloc=136260,456394&loc=136260,456394&zoom=8"
<span class='line'> 15</span>  *  >
<span class='line'> 16</span>  * OR
<span class='line'> 17</span>  *  &lt;iframe width="400" height="300" frameborder="0" 
<span class='line'> 18</span>  *    scrolling="no" marginheight="0" marginwidth="0" 
<span class='line'> 19</span>  *    src="api/api.html?mloc=136260,456394&bbox=130000,450000,150000,470000"
<span class='line'> 20</span>  *  >
<span class='line'> 21</span>  */</span><span class="WHIT">
<span class='line'> 22</span> 
<span class='line'> 23</span> </span><span class="COMM">/** 
<span class='line'> 24</span>  * Pdok namespace, will hold Api namespace
<span class='line'> 25</span>  * @namespace 
<span class='line'> 26</span>  */</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="NAME">Pdok</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'> 28</span> 
<span class='line'> 29</span> </span><span class="COMM">// current PdokKaartApi version</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="NAME">Pdok.API_VERSION_NUMBER</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'1.0.0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 31</span> 
<span class='line'> 32</span> </span><span class="COMM">// CONFIG</span><span class="WHIT">
<span class='line'> 33</span> 
<span class='line'> 34</span> </span><span class="COMM">// The api-url is the base-url for api.js, markersdefs, layerdefs etc</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="COMM">// The proxyhost is needed for the geocoder</span><span class="WHIT">
<span class='line'> 36</span> 
<span class='line'> 37</span> </span><span class="COMM">// PDOK LOKET PRODUKTIE</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="NAME">Pdok.ApiUrl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'https://kaart.pdok.nl/api'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="NAME">OpenLayers.ProxyHost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"http://"</span><span class="PUNC">+</span><span class="NAME">window.location.host</span><span class="PUNC">+</span><span class="STRN">"/proxy.php?url="</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// current pdokloket proxy</span><span class="WHIT">
<span class='line'> 40</span> 
<span class='line'> 41</span> </span><span class="COMM">// TEST</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="COMM">//Pdok.ApiUrl = 'http://www.duif.net/pdok/api';</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="COMM">//OpenLayers.ProxyHost = "http://"+window.location.host+"/cgi-bin/proxy.cgi?url=";</span><span class="WHIT">
<span class='line'> 44</span> 
<span class='line'> 45</span> </span><span class="COMM">// ONTWIKKEL</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="COMM">//Pdok.ApiUrl = 'http://localhost/pdokkaart/api';</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="COMM">//OpenLayers.ProxyHost = "http://"+window.location.host+"/cgi-bin/proxy.cgi?url=";</span><span class="WHIT">
<span class='line'> 48</span> 
<span class='line'> 49</span> 
<span class='line'> 50</span> </span><span class="NAME">OpenLayers.ImgPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'./img/'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 51</span> 
<span class='line'> 52</span> 
<span class='line'> 53</span> </span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">'default'</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">strokeColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'red'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">'default'</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fillColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'red'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">'default'</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">pointRadius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">'default'</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fillOpacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.8</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="COMM">// small point otherwise we see circle</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">'temporary'</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">pointRadius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">'temporary'</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">strokeColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'red'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">'temporary'</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fillColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'red'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="COMM">// some translations</span><span class="WHIT">
<span class='line'> 62</span> </span><span class="NAME">OpenLayers.Lang</span><span class="PUNC">[</span><span class="STRN">"nl"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 63</span> </span><span class="WHIT">    </span><span class="STRN">'unhandledRequest'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Het verzoek is niet afgehandeld met de volgende melding: ${statusText}"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="WHIT">    </span><span class="STRN">'Permalink'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Permanente verwijzing"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 65</span> </span><span class="WHIT">    </span><span class="STRN">'Overlays'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Kaartlagen"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 66</span> </span><span class="WHIT">    </span><span class="STRN">'Base Layer'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Ondergrond"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="WHIT">    </span><span class="STRN">'noFID'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Een optie die geen FID heeft kan niet bijgewerkt worden."</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">    </span><span class="STRN">'browserNotSupported'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Uw browser ondersteunt het weergeven van vectoren niet.\nMomenteel ondersteunde weergavemogelijkheden:\n${renderers}"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">    </span><span class="STRN">'minZoomLevelError'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"De eigenschap minZoomLevel is alleen bedoeld voor gebruik lagen met die afstammen van FixedZoomLevels-lagen.\nDat deze WFS-laag minZoomLevel controleert, is een overblijfsel uit het verleden.\nWe kunnen deze controle echter niet verwijderen zonder op OL gebaseerde applicaties die hervan afhankelijk zijn stuk te maken.\nDaarom heeft deze functionaliteit de eigenschap \'deprecated\' gekregen - de minZoomLevel wordt verwijderd in versie 3.0.\nGebruik in plaats van deze functie de mogelijkheid om min/max voor resolutie in te stellen zoals op de volgende pagina wordt beschreven:\nhttp://trac.openlayers.org/wiki/SettingZoomLevels"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="WHIT">    </span><span class="STRN">'commitSuccess'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"WFS-transactie: succesvol ${response}"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 71</span> </span><span class="WHIT">    </span><span class="STRN">'commitFailed'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"WFS-transactie: mislukt ${response}"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="WHIT">    </span><span class="STRN">'googleWarning'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"De Google-Layer kon niet correct geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct ingevoegd is.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen."</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 73</span> </span><span class="WHIT">    </span><span class="STRN">'getLayerWarning'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"De laag ${layerType} kon niet goed geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct is ingevoegd.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href=\'http://trac.openlayers.org/wiki/${layerLib}\' target=\'_blank\'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen."</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="WHIT">    </span><span class="STRN">'Scale = 1 : ${scaleDenom}'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Schaal = 1 : ${scaleDenom}"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 75</span> </span><span class="WHIT">    </span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"W"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 76</span> </span><span class="WHIT">    </span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"O"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 77</span> </span><span class="WHIT">    </span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 78</span> </span><span class="WHIT">    </span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Z"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">    </span><span class="STRN">'reprojectDeprecated'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"U gebruikt de optie \'reproject\' op de laag ${layerName}.\nDeze optie is vervallen: deze optie was ontwikkeld om gegevens over commerciële basiskaarten weer te geven, maar deze functionaliteit wordt nu bereikt door ondersteuning van Spherical Mercator.\nMeer informatie is beschikbaar op http://trac.openlayers.org/wiki/SphericalMercator."</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">    </span><span class="STRN">'methodDeprecated'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Deze methode is verouderd en wordt verwijderd in versie 3.0.\nGebruik ${newMethod}."</span><span class="WHIT">
<span class='line'> 81</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 82</span> </span><span class="NAME">OpenLayers.Lang.setCode</span><span class="PUNC">(</span><span class="STRN">'nl'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'> 83</span> 
<span class='line'> 84</span> 
<span class='line'> 85</span> </span><span class="NAME">Proj4js.defs</span><span class="PUNC">[</span><span class="STRN">"EPSG:28992"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +towgs84=565.040,49.910,465.840,-0.40939,0.35971,-1.86849,4.0772"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 86</span> 
<span class='line'> 87</span> </span><span class="NAME">Pdok.createBaseUri</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 88</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pathname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.pathname</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 89</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pathname</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pathname.search</span><span class="PUNC">(</span><span class="REGX">/\.html|\.php|.jsp/</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 91</span> </span><span class="WHIT">        </span><span class="NAME">pathparts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pathname.substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">pathname.search</span><span class="PUNC">(</span><span class="REGX">/\.html|\.php|.jsp/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 92</span> </span><span class="WHIT">        </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pathparts.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pathparts.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 93</span> </span><span class="WHIT">        </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path.join</span><span class="PUNC">(</span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 94</span> </span><span class="WHIT">        </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">'/'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 95</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 96</span> </span><span class="WHIT">    </span><span class="NAME">base</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.protocol</span><span class="PUNC">+</span><span class="STRN">'//'</span><span class="PUNC">+</span><span class="NAME">window.location.host</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">path</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 97</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">base</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 98</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 99</span> 
<span class='line'>100</span> </span><span class="COMM">// it is possible to override the markerdefinitions with a request parameter markersdef</span><span class="WHIT">
<span class='line'>101</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="STRN">'markersdef'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">    </span><span class="NAME">Pdok.markersdef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="STRN">'markersdef'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>103</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>104</span> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>105</span> </span><span class="WHIT">    </span><span class="COMM">// we use the markersdef from the api</span><span class="WHIT">
<span class='line'>106</span> </span><span class="WHIT">    </span><span class="NAME">Pdok.markersdef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Pdok.ApiUrl</span><span class="PUNC">+</span><span class="STRN">'/js/pdok-markers.js'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>107</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>108</span> </span><span class="COMM">// inject a script include for the markersdef, being either an external or the api included one</span><span class="WHIT">
<span class='line'>109</span> </span><span class="NAME">document.write</span><span class="PUNC">(</span><span class="STRN">'&lt;script type="text/javascript" src="'</span><span class="PUNC">+</span><span class="NAME">Pdok.markersdef</span><span class="PUNC">+</span><span class="STRN">'">&lt;/script>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>110</span> 
<span class='line'>111</span> </span><span class="COMM">// it is possible to override the layerdefinitions with a request parameter layersdef</span><span class="WHIT">
<span class='line'>112</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="STRN">'layersdef'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">    </span><span class="NAME">Pdok.layersdef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="STRN">'layersdef'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>114</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>115</span> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>116</span> </span><span class="WHIT">    </span><span class="COMM">// we use the layersdef from the api</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">    </span><span class="NAME">Pdok.layersdef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Pdok.ApiUrl</span><span class="PUNC">+</span><span class="STRN">'/js/pdok-layers.js'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>118</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>119</span> </span><span class="COMM">// inject a script include for the layersdef, being either an external or the api included one</span><span class="WHIT">
<span class='line'>120</span> </span><span class="NAME">document.write</span><span class="PUNC">(</span><span class="STRN">'&lt;script type="text/javascript" src="'</span><span class="PUNC">+</span><span class="NAME">Pdok.layersdef</span><span class="PUNC">+</span><span class="STRN">'">&lt;/script>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>121</span> 
<span class='line'>122</span> </span><span class="COMM">/**
<span class='line'>123</span>  * Creates an instance of the Pdok Api based on an optional config object &lt;a href="#constructor">more ...&lt;/a>
<span class='line'>124</span>  * 
<span class='line'>125</span>  * &lt;p>If there is not a config object, all properties of the api have a default value.&lt;/p>
<span class='line'>126</span>  * 
<span class='line'>127</span>  * The config object is a hash object like: &lt;pre>{ loc:'150000,380000', div:'map' }&lt;/pre>
<span class='line'>128</span>  * 
<span class='line'>129</span>  * &lt;p>The OpenLayers.Util.getParameters() function returns such an object.
<span class='line'>130</span>  * Giving the possiblitiy to create an Api object which uses url params in just
<span class='line'>131</span>  * two lines of code:&lt;/p>
<span class='line'>132</span>  * &lt;pre>
<span class='line'>133</span>  *    var config = OpenLayers.Util.getParameters();
<span class='line'>134</span>  *    api = Pdok.Api(config);
<span class='line'>135</span>  * &lt;/pre>
<span class='line'>136</span>  * All properties of the config object are overriding default values of Api
<span class='line'>137</span>  *
<span class='line'>138</span>  * @constructor
<span class='line'>139</span>  * @this {Pdok.Api}
<span class='line'>140</span>  * @param {Object} config A hash object with all possible config key/value pairs
<span class='line'>141</span>  */</span><span class="WHIT">
<span class='line'>142</span> </span><span class="NAME">Pdok.Api</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>143</span> 
<span class='line'>144</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>145</span>      * The zoom level property = the zoom level to start in (between 0 and 14)
<span class='line'>146</span>      * 
<span class='line'>147</span>      * @type int
<span class='line'>148</span>      */</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">    </span><span class="NAME">this.zoom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>150</span> 
<span class='line'>151</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>152</span>      * The location (x,y) to zoom to. A x,y commaseparated String (epsg:28992)
<span class='line'>153</span>      * @type String
<span class='line'>154</span>      */</span><span class="WHIT">
<span class='line'>155</span> </span><span class="WHIT">    </span><span class="NAME">this.loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>156</span> 
<span class='line'>157</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>158</span>      * A boundingbox (w,s,e,n) to zoom to. A commaseparated String of west,south,east,north
<span class='line'>159</span>      * @type String
<span class='line'>160</span>      */</span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">    </span><span class="NAME">this.bbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>162</span> 
<span class='line'>163</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>164</span>      * A commaseparated list of pdok id's (defined in pdok-layers.js). Eg: 'brt,top10'
<span class='line'>165</span>      * @type String
<span class='line'>166</span>      */</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">    </span><span class="NAME">this.pdoklayers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>168</span> 
<span class='line'>169</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>170</span>      * Reference to OpenLayers Map object
<span class='line'>171</span>      * @type OpenLayers.Map
<span class='line'>172</span>      */</span><span class="WHIT">
<span class='line'>173</span> </span><span class="WHIT">    </span><span class="NAME">this.map</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>174</span> 
<span class='line'>175</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>176</span>      * The location to put a marker. mloc = markerlocation
<span class='line'>177</span>      *
<span class='line'>178</span>      * By giving a mloc param (eg 125000,450000) in the config or querystring, a marker will be placed on that point (using mt0 as style)
<span class='line'>179</span>      * @type String
<span class='line'>180</span>      */</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">    </span><span class="NAME">this.mloc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>182</span> 
<span class='line'>183</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>184</span>      * Reference to an image URL for the marker. To be used in combination with mloc
<span class='line'>185</span>      *
<span class='line'>186</span>      * It is overriding the mt0 externalGraphic image
<span class='line'>187</span>      * @type URL
<span class='line'>188</span>      */</span><span class="WHIT">
<span class='line'>189</span> </span><span class="WHIT">    </span><span class="NAME">this.mimg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>190</span> 
<span class='line'>191</span> 
<span class='line'>192</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>193</span>      * Markertype property. You can set a mt (styletype) for your mloc. Eg 'mt3'
<span class='line'>194</span>      * @type String
<span class='line'>195</span>      */</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">    </span><span class="NAME">this.mt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>197</span> 
<span class='line'>198</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>199</span>      * If a popup should be used or not. Defaults to true
<span class='line'>200</span>      * @type boolean
<span class='line'>201</span>      */</span><span class="WHIT">
<span class='line'>202</span> </span><span class="WHIT">    </span><span class="NAME">this.showPopup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>203</span> 
<span class='line'>204</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>205</span>      * If a popup hover should be used or not Defaults to false
<span class='line'>206</span>      * @type boolean
<span class='line'>207</span>      */</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">    </span><span class="NAME">this.hoverPopup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>209</span> 
<span class='line'>210</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>211</span>      * Reference to popup titel, only used in case of the use of mloc
<span class='line'>212</span>      * @type String
<span class='line'>213</span>      */</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">    </span><span class="NAME">this.titel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>215</span> 
<span class='line'>216</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>217</span>      * Reference to popup text, only used in case of the use of mloc
<span class='line'>218</span>      * @type String
<span class='line'>219</span>      */</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">    </span><span class="NAME">this.tekst</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>221</span> 
<span class='line'>222</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>223</span>      * an URL to a text file, to be used loaded as features
<span class='line'>224</span>      *
<span class='line'>225</span>      * The text file format is determined by the OpenLayers.Format.Text Class
<span class='line'>226</span>      * 
<span class='line'>227</span>      * &lt;p>Examples of such txt files:
<span class='line'>228</span>      * &lt;pre>
<span class='line'>229</span>      * point  title   description
<span class='line'>230</span>      * # defaulting to epsg:28992 / RD
<span class='line'>231</span>      * # !!!!!! FIRST Y THEN X
<span class='line'>232</span>      * 517000,117960  foo omschrijving foo
<span class='line'>233</span>      * 511800,222000  faa omschrijving faa
<span class='line'>234</span>      * 541611,155111  fii omschrijving fii
<span class='line'>235</span>      * # alternative epsg:4326 / LatLon
<span class='line'>236</span>      * #52.64,4.84    foo omschrijving foo
<span class='line'>237</span>      * #52.59,6.38    faa omschrijving faa
<span class='line'>238</span>      * #51.73,5.39    fii omschrijving fii
<span class='line'>239</span>      * &lt;pre>
<span class='line'>240</span>      * or 
<span class='line'>241</span>      * &lt;pre>
<span class='line'>242</span>      * * lat  lon title   description
<span class='line'>243</span>      * # defaulting to epsg:28992 / RD
<span class='line'>244</span>      * # !!!!!! FIRST Y THEN X
<span class='line'>245</span>      * 517000 117960  foo omschrijving foo
<span class='line'>246</span>      * 511800 222000  faa omschrijving faa
<span class='line'>247</span>      * 541611 155111  fii omschrijving fii
<span class='line'>248</span>      * # alternative epsg:4326 / LatLon
<span class='line'>249</span>      * #52.64 4.84    foo omschrijving foo
<span class='line'>250</span>      * #52.59 6.38    faa omschrijving faa
<span class='line'>251</span>      * #51.73 5.39    fii omschrijving fii
<span class='line'>252</span>      * &lt;/pre>
<span class='line'>253</span>      * or an example with images and their dimensions
<span class='line'>254</span>      * &lt;pre>
<span class='line'>255</span>      * lat   lon title   description iconSize    iconOffset  icon
<span class='line'>256</span>      * 450000 140000  Ministerie ELenI    Economische Zaken Landbouw en Innovatie 32,37   16,-37  https://kaart.pdok.nl/api/markertypes/flag-nl.png
<span class='line'>257</span>      * 460000 160000  Kadaster    Kadaster    32,37   -16,-18 https://kaart.pdok.nl/api/markertypes/flag-blue.png
<span class='line'>258</span>      * 470000 170000  Rijkswaterstaat Infrastructuur en Milieu    64,72   -32,-36 https://kaart.pdok.nl/api/markertypes/vlc.png
<span class='line'>259</span>      * 480000 180000  Ministerie IenM Infrastructuur en Milieu    40,46   -20,-23 https://kaart.pdok.nl/api/markertypes/flag-blue.png
<span class='line'>260</span>      * &lt;/pre>
<span class='line'>261</span>      * &lt;/p>
<span class='line'>262</span>      * @see &lt;a href="../../../documentatie/examples/data/test1.txt">test1.txt&lt;/a>
<span class='line'>263</span>      * @see &lt;a href="../../../documentatie/examples/data/test2.txt">test2.txt&lt;/a>
<span class='line'>264</span>      * @type URL
<span class='line'>265</span>      */</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">    </span><span class="NAME">this.txturl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>267</span> 
<span class='line'>268</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>269</span>      * Wmts URL to be used as wmts layer. Always together with a wmtslayer and wmtsmatrixset parameter
<span class='line'>270</span>      * @type URL
<span class='line'>271</span>      */</span><span class="WHIT">
<span class='line'>272</span> </span><span class="WHIT">    </span><span class="NAME">this.wmtsurl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>273</span> 
<span class='line'>274</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>275</span>      * The layername of the wmts service. ALways together with a wmtsurl and wmtsmatrixset parameter
<span class='line'>276</span>      * @type String
<span class='line'>277</span>      */</span><span class="WHIT">
<span class='line'>278</span> </span><span class="WHIT">    </span><span class="NAME">this.wmtslayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>279</span> 
<span class='line'>280</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>281</span>      * The matrixset of the wmts service. ALways together with a wmtsurl and wmtslayer parameter
<span class='line'>282</span>      * @type String
<span class='line'>283</span>      */</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">    </span><span class="NAME">this.wmtsmatrixset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>285</span> 
<span class='line'>286</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>287</span>      * The WMS url to be used as a wms layer. Always together with a wmslayers parameter
<span class='line'>288</span>      * @type URL
<span class='line'>289</span>      */</span><span class="WHIT">
<span class='line'>290</span> </span><span class="WHIT">    </span><span class="NAME">this.wmsurl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>291</span> 
<span class='line'>292</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>293</span>      * The wms layers parameter, a commaseparated string of layername(s). Always together with a wmsurl parameter
<span class='line'>294</span>      * @type String
<span class='line'>295</span>      */</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">    </span><span class="NAME">this.wmslayers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>297</span> 
<span class='line'>298</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>299</span>      * The TMS url to be loaded as a layer. Always together with tmslayer
<span class='line'>300</span>      * @type URL
<span class='line'>301</span>      */</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">    </span><span class="NAME">this.tmsurl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>304</span>      * The tms layer parameter, a layer name of the tms service. Always together with a tmsurl parameter
<span class='line'>305</span>      * @type String
<span class='line'>306</span>      */</span><span class="WHIT">
<span class='line'>307</span> </span><span class="WHIT">    </span><span class="NAME">this.tmslayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>308</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>309</span>      * The tmstype parameter, the image format to use (defaults to .png). Always together with a tmsurl and tmslayer parameter
<span class='line'>310</span>      * @type String
<span class='line'>311</span>      */</span><span class="WHIT">
<span class='line'>312</span> </span><span class="WHIT">    </span><span class="NAME">this.tmstype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'png'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>313</span> 
<span class='line'>314</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>315</span>      * Url to a KML file, to be used as feature layer (note that in KML coordinates always in wgs84/latlon)
<span class='line'>316</span>      * &lt;p>
<span class='line'>317</span>      * An example of a minimalistic KML:
<span class='line'>318</span>      * &lt;pre>
<span class='line'>319</span>      *  &lt;kml xmlns="http://earth.google.com/kml/2.0"&gt;
<span class='line'>320</span>      *  &lt;Placemark&gt;
<span class='line'>321</span>      *  &lt;name&gt;Naam&lt;/name&gt;
<span class='line'>322</span>      *  &lt;description&gt;Omschrijving&lt;/description&gt;
<span class='line'>323</span>      *  &lt;Point&gt;&lt;coordinates&gt;4.835397256016842,53.03622449301179&lt;/coordinates&gt;&lt;/Point&gt;
<span class='line'>324</span>      *  &lt;/Placemark&gt;
<span class='line'>325</span>      *  &lt;/kml&gt;·
<span class='line'>326</span>      * &lt;pre>
<span class='line'>327</span>      * Or one in which we define one of our styletypes;
<span class='line'>328</span>      * &lt;pre>
<span class='line'>329</span>      *  &lt;kml xmlns="http://earth.google.com/kml/2.0"&gt;
<span class='line'>330</span>      *  &lt;Placemark&gt;
<span class='line'>331</span>      *  &lt;name&gt;Naam&lt;/name&gt;
<span class='line'>332</span>      *  &lt;description&gt;Omschrijving&lt;/description&gt;
<span class='line'>333</span>      *  &lt;Point&gt;&lt;coordinates&gt;4.835397256016842,53.03622449301179&lt;/coordinates&gt;&lt;/Point&gt;
<span class='line'>334</span>      *  &lt;ExtendedData&gt;&lt;Data name="styletype"&gt;&lt;value&gt;mt3&lt;/value&gt;&lt;/Data&gt;&lt;/ExtendedData&gt;
<span class='line'>335</span>      *  &lt;/Placemark&gt;
<span class='line'>336</span>      *  &lt;/kml&gt;·
<span class='line'>337</span>      * &lt;pre>
<span class='line'>338</span>      * &lt;/p>
<span class='line'>339</span>      * The Styles in the KML will be used by default. If you do not want that, set the kmlstyles parameter to false
<span class='line'>340</span>      * @type URL
<span class='line'>341</span>      */</span><span class="WHIT">
<span class='line'>342</span> </span><span class="WHIT">    </span><span class="NAME">this.kmlurl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>343</span> 
<span class='line'>344</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>345</span>      * Property to determine if the internal styles of a KML file should be used for visualisation. 
<span class='line'>346</span>      *
<span class='line'>347</span>      * Defaults to false. In that case our styletype mt0 will be used. Of which the externalGraphic can be overridden via the mimg (markerimg) parameter
<span class='line'>348</span>      * @type Boolean
<span class='line'>349</span>      */</span><span class="WHIT">
<span class='line'>350</span> </span><span class="WHIT">    </span><span class="NAME">this.kmlstyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// defaults to taking internal KML styling into account</span><span class="WHIT">
<span class='line'>351</span> 
<span class='line'>352</span> </span><span class="WHIT">    </span><span class="COMM">// Reference to layerswitch object (not to be used at the moment)</span><span class="WHIT">
<span class='line'>353</span> </span><span class="WHIT">    </span><span class="NAME">this.ls</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>354</span> 
<span class='line'>355</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>356</span>      * To determine if the layer switcher should be shown or not. Defaults to true
<span class='line'>357</span>      * @type Boolean
<span class='line'>358</span>      */</span><span class="WHIT">
<span class='line'>359</span> </span><span class="WHIT">    </span><span class="NAME">this.showlayerswitcher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>360</span> 
<span class='line'>361</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>362</span>      * Reference to the DIV-id the map should be rendered in.
<span class='line'>363</span>      * Note that you have to set this one to have two maps in one page!
<span class='line'>364</span>      * @type String
<span class='line'>365</span>      */</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">    </span><span class="NAME">this.div</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'map'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>367</span> 
<span class='line'>368</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>369</span>      * Reference to internal styles Object with all marker, lines and polygon rules.
<span class='line'>370</span>      *
<span class='line'>371</span>      * This Object is created from the pdok-markers.js file. Which is a json file with marker definitions
<span class='line'>372</span>      * @type Object
<span class='line'>373</span>      */</span><span class="WHIT">
<span class='line'>374</span> </span><span class="WHIT">    </span><span class="NAME">this.styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>375</span> 
<span class='line'>376</span> </span><span class="WHIT">    </span><span class="COMM">// internal name of the features layer</span><span class="WHIT">
<span class='line'>377</span> </span><span class="WHIT">    </span><span class="NAME">this.FEATURESLAYER_NAME</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Markers"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>378</span> 
<span class='line'>379</span> </span><span class="WHIT">    </span><span class="COMM">// this.features can come as KML string from config/params</span><span class="WHIT">
<span class='line'>380</span> </span><span class="WHIT">    </span><span class="COMM">// after handling this, it contains an array of features</span><span class="WHIT">
<span class='line'>381</span> </span><span class="WHIT">    </span><span class="NAME">this.features</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>382</span> 
<span class='line'>383</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>384</span>      * Reference to featuresLayer (= layer where you draw feature on)
<span class='line'>385</span>      * @type OpenLayers.Layer.Vector
<span class='line'>386</span>      */</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">    </span><span class="NAME">this.featuresLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>388</span> 
<span class='line'>389</span> </span><span class="WHIT">    </span><span class="COMM">// References to different drawing controls we use for the edit tools</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">    </span><span class="NAME">this.drawFeaturePointControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">    </span><span class="NAME">this.drawFeatureLineControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>392</span> </span><span class="WHIT">    </span><span class="NAME">this.drawFeaturePolygonControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>393</span> </span><span class="WHIT">    </span><span class="NAME">this.editFeatureControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">    </span><span class="COMM">// References to select control for features in the featurelayer</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">    </span><span class="NAME">this.selectControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>396</span> </span><span class="WHIT">    </span><span class="COMM">// Reference to locationLayer (= layer to be used by the locationtool)</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">    </span><span class="NAME">this.locationLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">    </span><span class="COMM">// References to different drawing controls to be used by the locationtool</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">    </span><span class="NAME">this.drawLocationPointControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">    </span><span class="NAME">this.drawLocationLineControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">    </span><span class="NAME">this.drawLocationPolygonControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">    </span><span class="NAME">this.editLocationControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>403</span> 
<span class='line'>404</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>405</span>      * Boolean which determines if the Api started in Locationtool/Lokatieprikker modus or not. Defaults to false
<span class='line'>406</span>      * @type Boolean
<span class='line'>407</span>      */</span><span class="WHIT">
<span class='line'>408</span> </span><span class="WHIT">    </span><span class="NAME">this.locationtool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>410</span>      * Style to be used for the locationtool. Defaults to 'mt0'. NOTE: this also determines the TYPE of the locationtool (point, line or polygon) !!
<span class='line'>411</span>      * @type String
<span class='line'>412</span>      */</span><span class="WHIT"> 
<span class='line'>413</span>     </span><span class="NAME">this.locationtoolstyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mt0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>414</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>415</span>      * Name for X field to be used for the locationtool. Defaults to 'x'.
<span class='line'>416</span>      * @type String
<span class='line'>417</span>      */</span><span class="WHIT"> 
<span class='line'>418</span>     </span><span class="NAME">this.locationtoolxfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'x'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>419</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>420</span>      * Name for Y field to be used for the locationtool. Defaults to 'y'.
<span class='line'>421</span>      * @type String
<span class='line'>422</span>      */</span><span class="WHIT"> 
<span class='line'>423</span>     </span><span class="NAME">this.locationtoolyfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'y'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>424</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>425</span>      * Name for wkt field to be used for the locationtool. Defaults to 'wkt'. If this field is set, x and y will be ignored.
<span class='line'>426</span>      * @type String
<span class='line'>427</span>      */</span><span class="WHIT"> 
<span class='line'>428</span>     </span><span class="NAME">this.locationtoolwktfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'wkt'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>430</span>      * Minimal zoom to be able to set a point in the locationtool modus
<span class='line'>431</span>      * @type int
<span class='line'>432</span>      */</span><span class="WHIT"> 
<span class='line'>433</span>     </span><span class="NAME">this.locationtoolzmin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>434</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>435</span>      * Maximal zoom to be able to set a point in the locationtool modus
<span class='line'>436</span>      * @type int
<span class='line'>437</span>      */</span><span class="WHIT"> 
<span class='line'>438</span>     </span><span class="NAME">this.locationtoolzmax</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'30'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>439</span> 
<span class='line'>440</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>441</span>      * Url to a markersdefinition file.
<span class='line'>442</span>      * &lt;p>
<span class='line'>443</span>      * This is a simple json file with actual style properies like from 
<span class='line'>444</span>      * OpenLayers.Feature.Vector.style.default
<span class='line'>445</span>      * An example:
<span class='line'>446</span>      * &lt;pre>
<span class='line'>447</span>      * Pdok.Api.prototype.defaultStyles=[ 
<span class='line'>448</span>      *         // all point marker styles will use mt0 as default 
<span class='line'>449</span>      *         // so you only have to define the props that are different from mt0 
<span class='line'>450</span>      *         // mt0, pt0, lt0 are defined in pdok-api.js, so defining it here will override that one 
<span class='line'>451</span>      *     { 
<span class='line'>452</span>      *         id: 'mt1', 
<span class='line'>453</span>      *         name: 'Informatiebord blauw', 
<span class='line'>454</span>      *         externalGraphic: Pdok.ApiUrl + '/markertypes/emblem-notice.png', 
<span class='line'>455</span>      *         graphicHeight: 32, 
<span class='line'>456</span>      *         graphicWidth: 32, 
<span class='line'>457</span>      *         graphicYOffset: -16 
<span class='line'>458</span>      *     }, 
<span class='line'>459</span>      *     {
<span class='line'>460</span>      *         id: 'pt18', 
<span class='line'>461</span>      *         fillOpacity: 0.0, 
<span class='line'>462</span>      *         strokeColor: 'orange', 
<span class='line'>463</span>      *         strokeWidth: 2, 
<span class='line'>464</span>      *         name: 'Oranje'
<span class='line'>465</span>      *     },
<span class='line'>466</span>      *     {
<span class='line'>467</span>      *         id:'lt8',  
<span class='line'>468</span>      *         strokeColor:'green',  
<span class='line'>469</span>      *         strokeWidth:3,  
<span class='line'>470</span>      *         strokeOpacity:0.5,  
<span class='line'>471</span>      *         name:'groen 2px transparant'  
<span class='line'>472</span>      *     }
<span class='line'>473</span>      * ]
<span class='line'>474</span>      * &lt;/pre>
<span class='line'>475</span>      * &lt;/p>
<span class='line'>476</span>      * @type url
<span class='line'>477</span>      */</span><span class="WHIT">
<span class='line'>478</span> </span><span class="WHIT">    </span><span class="NAME">this.markersdef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>479</span> 
<span class='line'>480</span> </span><span class="WHIT">    </span><span class="COMM">// an external markersdef is temporarily parked in Pdok.markersdef</span><span class="WHIT">
<span class='line'>481</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Pdok.markersdef</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>482</span> </span><span class="WHIT">        </span><span class="NAME">this.markersdef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">+</span><span class="NAME">Pdok.markersdef</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>483</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>484</span> 
<span class='line'>485</span> 
<span class='line'>486</span> </span><span class="WHIT">    </span><span class="NAME">this.layersdef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>487</span> 
<span class='line'>488</span> </span><span class="WHIT">    </span><span class="COMM">// an external layersdef is temporarily parked in Pdok.layersdef</span><span class="WHIT">
<span class='line'>489</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Pdok.layersdef</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">        </span><span class="NAME">this.layersdef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">+</span><span class="NAME">Pdok.layersdef</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>492</span> 
<span class='line'>493</span> </span><span class="WHIT">    </span><span class="NAME">this.defaultLayers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">        </span><span class="NAME">this.defaultPdokLayers</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.defaultLayers</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>495</span> 
<span class='line'>496</span> </span><span class="WHIT">    </span><span class="COMM">// create this.styles, based on either this.defaultStyles object, OR via a this.customStyles object</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">    </span><span class="NAME">this.createStyles</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>498</span> 
<span class='line'>499</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>500</span> </span><span class="WHIT">        </span><span class="COMM">// hack to make x and y fields null</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">        </span><span class="COMM">// better fix would be to remove one of the three locationtool fields</span><span class="WHIT">
<span class='line'>502</span> </span><span class="WHIT">        </span><span class="COMM">// so you have either ONE field (wkt) or TWO (x and y)</span><span class="WHIT">
<span class='line'>503</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">config.locationtoolwktfield</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">            </span><span class="NAME">config.locationtoolxfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>505</span> </span><span class="WHIT">            </span><span class="NAME">config.locationtoolyfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>506</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">        </span><span class="NAME">OpenLayers.Util.extend</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">config</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>509</span> 
<span class='line'>510</span> </span><span class="WHIT">    </span><span class="NAME">this.createOlMap</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>511</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>512</span> 
<span class='line'>513</span> </span><span class="COMM">// Array will contain OpenLayers.Style Objects</span><span class="WHIT">
<span class='line'>514</span> </span><span class="NAME">Pdok.Api.prototype.defaultStyles</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>515</span> 
<span class='line'>516</span> </span><span class="COMM">/**
<span class='line'>517</span>  * Object which holds a Map of an shortname/id to'layer'-configuration objects. All layer objects holds hold an layertype, and other(OpenLayers-option) properties specific for that type of (OpenLayers)-layer.
<span class='line'>518</span>  * Be carefull to use the right properties! Eg a OpenLayers-WMS-Layer has a property 'layers' (note the plural form), while the OpenLayers-WMTS-Layer has a property 'layer' (without s!)
<span class='line'>519</span>  * @type Object
<span class='line'>520</span>  */</span><span class="WHIT">
<span class='line'>521</span> </span><span class="NAME">Pdok.Api.prototype.defaultPdokLayers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>522</span> </span><span class="WHIT">        </span><span class="NAME">BRT</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT">            </span><span class="NAME">layertype</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'WMTS'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>524</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'BRT Achtergrondkaart (WMTS)'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'http://geodata.nationaalgeoregister.nl/wmts/'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>526</span> </span><span class="WHIT">            </span><span class="NAME">layer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'brtachtergrondkaart'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">            </span><span class="NAME">style</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>528</span> </span><span class="WHIT">            </span><span class="NAME">matrixSet</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'EPSG:28992'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>529</span> </span><span class="WHIT">            </span><span class="NAME">visibility</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>530</span>             </span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">            </span><span class="NAME">attribution</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'(c) OSM & Kadaster'</span><span class="WHIT">
<span class='line'>532</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>533</span> </span><span class="WHIT">        </span><span class="NAME">CBS_GEMEENTEN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>534</span> </span><span class="WHIT">            </span><span class="NAME">layertype</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'WMS'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>535</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CBS Gemeentegrenzen 2008 (WMS)'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>536</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'http://geodata.nationaalgeoregister.nl/bevolkingskernen2008/wms'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">            </span><span class="NAME">layers</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'gemeentegrens_generalisatie_2008'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">            </span><span class="NAME">transparent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'true'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">            </span><span class="NAME">format</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'image/png'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">            </span><span class="NAME">visibility</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">            </span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>542</span> </span><span class="WHIT">            </span><span class="NAME">singleTile</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>543</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>544</span> </span><span class="WHIT">        </span><span class="NAME">CBS_PROVINCIES</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>545</span> </span><span class="WHIT">            </span><span class="NAME">layertype</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'WMS'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>546</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'CBS Provinciegrenzen 2008 (WMS)'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>547</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'http://geodata.nationaalgeoregister.nl/bevolkingskernen2008/wms'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>548</span> </span><span class="WHIT">            </span><span class="NAME">layers</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'provgrens_generalisatie_2008'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>549</span> </span><span class="WHIT">            </span><span class="NAME">transparent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'true'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>550</span> </span><span class="WHIT">            </span><span class="NAME">format</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'image/png'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>551</span> </span><span class="WHIT">            </span><span class="NAME">visibility</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>552</span> </span><span class="WHIT">            </span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>553</span> </span><span class="WHIT">            </span><span class="NAME">singleTile</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>554</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>555</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>556</span> 
<span class='line'>557</span> </span><span class="COMM">/**
<span class='line'>558</span>  *
<span class='line'>559</span>  * Given all properties of this Api-instance, create an OpenLayers Map object and return it
<span class='line'>560</span>  * For internal use only
<span class='line'>561</span>  *
<span class='line'>562</span>  * @return OpenLayers.Map object
<span class='line'>563</span>  */</span><span class="WHIT">
<span class='line'>564</span> </span><span class="NAME">Pdok.Api.prototype.createOlMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>565</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">controls</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>566</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.showlayerswitcher</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>567</span> </span><span class="WHIT">    	</span><span class="NAME">controls</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>568</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Attribution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>569</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Navigation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>570</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Zoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>571</span> </span><span class="WHIT">			</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.ScaleLine</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">bottomOutUnits</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">,</span><span class="NAME">bottomInUnits</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>572</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>573</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>574</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.showlayerswitcher</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.showlayerswitcher.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"true"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>575</span> </span><span class="WHIT">    	</span><span class="NAME">controls</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>576</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Attribution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>577</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Navigation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>578</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Zoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>579</span> </span><span class="WHIT">			</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.ScaleLine</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">bottomOutUnits</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">,</span><span class="NAME">bottomInUnits</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>580</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.LayerSwitcher</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>581</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>582</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>583</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>584</span> </span><span class="WHIT">    </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>585</span> </span><span class="WHIT">    	</span><span class="NAME">controls</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>586</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Attribution</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>587</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Navigation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>588</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Zoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>589</span> </span><span class="WHIT">			</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.ScaleLine</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">bottomOutUnits</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">,</span><span class="NAME">bottomInUnits</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>592</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">olMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Map</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>593</span> </span><span class="WHIT">        </span><span class="NAME">controls</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">controls</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>594</span> </span><span class="WHIT">        </span><span class="NAME">maxExtent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Bounds</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">285401.92</span><span class="PUNC">,</span><span class="NUMB">22598.08</span><span class="PUNC">,</span><span class="NUMB">595401.9199999999</span><span class="PUNC">,</span><span class="NUMB">903401.9199999999</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>595</span> </span><span class="WHIT">        </span><span class="NAME">theme</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>596</span> </span><span class="WHIT">		</span><span class="NAME">resolutions</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">3440.64</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1720.32</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">860.16</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">430.08</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">215.04</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">107.52</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">53.76</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>597</span> </span><span class="WHIT">					</span><span class="NUMB">26.88</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">13.44</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">6.72</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3.36</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1.68</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.84</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.42</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.21</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>598</span> </span><span class="WHIT">        </span><span class="NAME">units</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'m'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>599</span> </span><span class="WHIT">        </span><span class="NAME">projection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="STRN">"EPSG:28992"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">        </span><span class="NAME">div</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.div</span><span class="WHIT">
<span class='line'>601</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>602</span> </span><span class="WHIT">    </span><span class="NAME">this.map</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">olMap</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>603</span> </span><span class="WHIT">	
<span class='line'>604</span> 	</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">showBRT</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">olMap.getLayersByName</span><span class="PUNC">(</span><span class="STRN">"BRT Achtergrondkaart"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layerIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layerIndex</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>608</span> </span><span class="WHIT">				</span><span class="NAME">olMap.setBaseLayer</span><span class="PUNC">(</span><span class="NAME">layers</span><span class="PUNC">[</span><span class="NAME">layerIndex</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>609</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>610</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>611</span> </span><span class="WHIT">	</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">showTOP10</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>612</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">olMap.getLayersByName</span><span class="PUNC">(</span><span class="STRN">"TOP10NL"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layerIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">layers.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">layerIndex</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>614</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>615</span> </span><span class="WHIT">				</span><span class="NAME">olMap.setBaseLayer</span><span class="PUNC">(</span><span class="NAME">layers</span><span class="PUNC">[</span><span class="NAME">layerIndex</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.ls</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>619</span> </span><span class="WHIT">		</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">showLufo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">			</span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"Helaas, er zijn nog geen\nluchtfoto's beschikbaar binnen PDOK'"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">	    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">panel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.Panel</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>623</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">openBRT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">			</span><span class="NAME">title</span><span class="PUNC">:</span><span class="STRN">"Toon de BRT Achtergrondkaart als ondergrond"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>625</span> </span><span class="WHIT">			</span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.TYPE_BUTTON</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>626</span> </span><span class="WHIT">			</span><span class="NAME">trigger</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">showBRT</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>627</span> </span><span class="WHIT">			</span><span class="NAME">displayClass</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"openBRT"</span><span class="WHIT">
<span class='line'>628</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>629</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">openTOP10</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">			</span><span class="NAME">title</span><span class="PUNC">:</span><span class="STRN">"Toon de TOP10NL als ondergrond"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">			</span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.TYPE_BUTTON</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>632</span> </span><span class="WHIT">			</span><span class="NAME">trigger</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">showTOP10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>633</span> </span><span class="WHIT">			</span><span class="NAME">displayClass</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"openTOP10"</span><span class="WHIT">
<span class='line'>634</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>635</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">openLufo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">			</span><span class="NAME">title</span><span class="PUNC">:</span><span class="STRN">"Toon de luchtfoto's als ondergrond"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">			</span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.TYPE_BUTTON</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">			</span><span class="NAME">trigger</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">showLufo</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">			</span><span class="NAME">displayClass</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"openLufo"</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">	
<span class='line'>642</span> 		</span><span class="NAME">panel.addControls</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">openLufo</span><span class="PUNC">,</span><span class="NAME">openTOP10</span><span class="PUNC">,</span><span class="NAME">openBRT</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>643</span> </span><span class="WHIT">		</span><span class="NAME">olMap.addControl</span><span class="PUNC">(</span><span class="NAME">panel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>644</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>645</span> 
<span class='line'>646</span> </span><span class="WHIT">    </span><span class="COMM">// apply layer if a layer was given</span><span class="WHIT">
<span class='line'>647</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.pdoklayers</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>648</span> </span><span class="WHIT">        </span><span class="COMM">// if there is just one layer (without comma's), OL returns a String:</span><span class="WHIT">
<span class='line'>649</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this.pdoklayers</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">            </span><span class="NAME">this.pdoklayers</span><span class="PUNC">=</span><span class="NAME">this.pdoklayers.split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">        </span><span class="NAME">this.addLayers</span><span class="PUNC">(</span><span class="NAME">this.pdoklayers</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">olMap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">        </span><span class="COMM">// if the map does NOT have a baseLayer, always add BRT layer</span><span class="WHIT">
<span class='line'>654</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">olMap.baseLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>655</span> </span><span class="WHIT">            </span><span class="COMM">//olMap.addLayer(this.createWMTSLayer( this.defaultLayers.BRT ));</span><span class="WHIT">
<span class='line'>656</span> </span><span class="WHIT">            </span><span class="NAME">this.addLayers</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">'BRT'</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>657</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>658</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>659</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>660</span> </span><span class="WHIT">        </span><span class="COMM">// not layer param, at least load one default layer</span><span class="WHIT">
<span class='line'>661</span> </span><span class="WHIT">        </span><span class="NAME">this.addLayers</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">'BRT'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">olMap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>662</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>663</span> 
<span class='line'>664</span> </span><span class="WHIT">    </span><span class="COMM">// possiblitiy to override externalGraphic of mt0</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.mimg</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>666</span> </span><span class="WHIT">        </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">'mt0'</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">externalGraphic</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mimg</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>667</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>668</span> 
<span class='line'>669</span> </span><span class="WHIT">    </span><span class="COMM">// apply WMSURL and WMSLAYERS if applicable</span><span class="WHIT">
<span class='line'>670</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.wmsurl</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.wmslayers</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>671</span> </span><span class="WHIT">        </span><span class="NAME">this.addWMS</span><span class="PUNC">(</span><span class="NAME">this.wmsurl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.wmslayers</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>672</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>673</span> 
<span class='line'>674</span> </span><span class="WHIT">    </span><span class="COMM">// apply WMTSURL and WMTSLAYER and WMTSMATRIXSET if applicable</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.wmtsurl</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.wmtslayer</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.wmtsmatrixset</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">        </span><span class="NAME">this.addWMTS</span><span class="PUNC">(</span><span class="NAME">this.wmtsurl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.wmtslayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.wmtsmatrixset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>678</span> 
<span class='line'>679</span> </span><span class="WHIT">    </span><span class="COMM">// apply TMSURL and TMSLAYERS if applicable</span><span class="WHIT">
<span class='line'>680</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.tmsurl</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.tmslayer</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>681</span> </span><span class="WHIT">        </span><span class="NAME">this.addTMS</span><span class="PUNC">(</span><span class="NAME">this.tmsurl</span><span class="PUNC">,</span><span class="NAME">this.tmslayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.tmstype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>682</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>683</span> 
<span class='line'>684</span> </span><span class="WHIT">    </span><span class="COMM">// apply KMLURL if applicable</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.kmlurl</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">        </span><span class="NAME">this.addKML</span><span class="PUNC">(</span><span class="NAME">this.kmlurl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.kmlstyles</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>688</span> 
<span class='line'>689</span> </span><span class="WHIT">    </span><span class="COMM">// apply TXTURL if applicable</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.txturl</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">        </span><span class="NAME">this.addTxt</span><span class="PUNC">(</span><span class="NAME">this.txturl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>693</span> 
<span class='line'>694</span> </span><span class="WHIT">    </span><span class="COMM">// apply BBOX or zoomlevel and location</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.bbox</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">        </span><span class="NAME">olMap.zoomToExtent</span><span class="PUNC">(</span><span class="NAME">OpenLayers.Bounds.fromArray</span><span class="PUNC">(</span><span class="NAME">this.bbox</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">transform</span><span class="PUNC">(</span><span class="NAME">olMap.displayProjection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">olMap.getProjectionObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.zoom</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.loc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this.loc</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">            </span><span class="NAME">this.loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.loc.split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">        </span><span class="NAME">olMap.setCenter</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.loc</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.loc</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.zoom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">        </span><span class="COMM">//olMap.zoomToMaxExtent();</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">        </span><span class="NAME">olMap.zoomToExtent</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">15000</span><span class="PUNC">,</span><span class="NUMB">300000</span><span class="PUNC">,</span><span class="NUMB">300000</span><span class="PUNC">,</span><span class="NUMB">640000</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>706</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>707</span> 
<span class='line'>708</span> </span><span class="WHIT">    </span><span class="COMM">// featuresLayer is used for all features/markers</span><span class="WHIT">
<span class='line'>709</span> </span><span class="WHIT">    </span><span class="NAME">this.featuresLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.Vector</span><span class="PUNC">(</span><span class="NAME">this.FEATURESLAYER_NAME</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>710</span> </span><span class="WHIT">    </span><span class="NAME">olMap.addLayer</span><span class="PUNC">(</span><span class="NAME">this.featuresLayer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>711</span> 
<span class='line'>712</span> </span><span class="WHIT">    </span><span class="COMM">// locationLayer holds features for 'kaarprikker/locationtool'</span><span class="WHIT">
<span class='line'>713</span> </span><span class="WHIT">    </span><span class="NAME">this.locationLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.Vector</span><span class="PUNC">(</span><span class="STRN">'locationtool'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>714</span> </span><span class="WHIT">        </span><span class="NAME">name</span><span class="PUNC">:</span><span class="STRN">'locations'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">displayInLayerSwitcher</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>715</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>716</span> </span><span class="WHIT">    </span><span class="NAME">olMap.addLayer</span><span class="PUNC">(</span><span class="NAME">this.locationLayer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>717</span> 
<span class='line'>718</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this.features</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this.features</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">        </span><span class="COMM">// meaning we received a features string (kml) from the outside</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">        </span><span class="COMM">// features string handled, this.features now used as feature array</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.features.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">kmlString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.features.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">            </span><span class="NAME">this.features</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>724</span> </span><span class="WHIT">            </span><span class="NAME">this.addFeaturesFromString</span><span class="PUNC">(</span><span class="NAME">kmlString</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'KML'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>725</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>726</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>727</span> 
<span class='line'>728</span> </span><span class="WHIT">    </span><span class="COMM">// add marker and use markertype if given, otherwise the default marker</span><span class="WHIT">
<span class='line'>729</span> </span><span class="WHIT">    </span><span class="COMM">// backward compatibility: mloc is alway point</span><span class="WHIT">
<span class='line'>730</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.mloc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>731</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wkt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'POINT('</span><span class="PUNC">+</span><span class="NAME">this.mloc</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">' '</span><span class="PUNC">+</span><span class="NAME">this.mloc</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">')'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>732</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.mt</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">            </span><span class="NAME">this.mt</span><span class="PUNC">=</span><span class="STRN">'mt0'</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// mt0 is default point symbol</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">        </span><span class="NAME">this.features.push</span><span class="PUNC">(</span><span class="NAME">this.createFeature</span><span class="PUNC">(</span><span class="NAME">wkt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.mt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.titel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.tekst</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>737</span> 
<span class='line'>738</span> </span><span class="WHIT">    </span><span class="COMM">// selectControl for popups</span><span class="WHIT">
<span class='line'>739</span> </span><span class="WHIT">    </span><span class="NAME">this.selectControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.SelectFeature</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>740</span> </span><span class="WHIT">            </span><span class="NAME">this.featuresLayer</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>741</span>             </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>742</span> </span><span class="WHIT">                </span><span class="NAME">hover</span><span class="PUNC">:</span><span class="NAME">this.hoverPopup</span><span class="WHIT">
<span class='line'>743</span> </span><span class="WHIT">                </span><span class="COMM">// implement some on magic to have a visible selection,</span><span class="WHIT">
<span class='line'>744</span> </span><span class="WHIT">                </span><span class="COMM">// which we lost when we gave every feature a style</span><span class="WHIT">
<span class='line'>745</span> </span><span class="WHIT">                </span><span class="COMM">/*
<span class='line'>746</span>                 onBeforeSelect:function(feature){
<span class='line'>747</span>                     if(feature.style){
<span class='line'>748</span>                         feature.style.strokeWidth+=2;
<span class='line'>749</span>                         feature.style.graphicWidth+=5;
<span class='line'>750</span>                         feature.style.graphicHeight+=5;
<span class='line'>751</span>                     }
<span class='line'>752</span>                 },
<span class='line'>753</span>                 onUnselect:function(feature){
<span class='line'>754</span>                     if(feature.style){
<span class='line'>755</span>                         feature.style.strokeWidth-=2;
<span class='line'>756</span>                         feature.style.graphicWidth-=5;
<span class='line'>757</span>                         feature.style.graphicHeight-=5;
<span class='line'>758</span>                     }
<span class='line'>759</span>                 }
<span class='line'>760</span>                 */</span><span class="WHIT">
<span class='line'>761</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>762</span> </span><span class="WHIT">    </span><span class="NAME">olMap.addControl</span><span class="PUNC">(</span><span class="NAME">this.selectControl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.showPopup</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">        </span><span class="NAME">this.enablePopups</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">        </span><span class="NAME">this.selectControl.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>767</span> 
<span class='line'>768</span> </span><span class="WHIT">    </span><span class="NAME">this.featuresLayer.addFeatures</span><span class="PUNC">(</span><span class="NAME">this.features</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>769</span> 
<span class='line'>770</span> </span><span class="WHIT">    </span><span class="COMM">// enable Locationtool IF this.locationtool is set via config</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.locationtool</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>772</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xorwkt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.locationtoolwktfield</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.locationtoolyfield</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">            </span><span class="NAME">yorwkt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.locationtoolyfield</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>776</span> </span><span class="WHIT">        </span><span class="NAME">this.enableLocationTool</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.locationtoolstyle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">            </span><span class="NAME">this.locationtoolzmin</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">            </span><span class="NAME">this.locationtoolzmax</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>779</span> </span><span class="WHIT">            </span><span class="NAME">xorwkt</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>780</span> </span><span class="WHIT">            </span><span class="NAME">this.locationtoolyfield</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">olMap</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>784</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>785</span> 
<span class='line'>786</span> </span><span class="COMM">/**
<span class='line'>787</span>  * @private
<span class='line'>788</span>  * Click handler for a feature to show a popup
<span class='line'>789</span>  * Some magic is needed to handle empty popup content
<span class='line'>790</span>  */</span><span class="WHIT">
<span class='line'>791</span> </span><span class="NAME">Pdok.Api.prototype.onPopupFeatureSelect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">    </span><span class="NAME">feature</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.feature</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'name'</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>795</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="PUNC">=</span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'name'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>796</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>797</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'description'</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="PUNC">=</span><span class="NAME">content</span><span class="PUNC">+</span><span class="STRN">"&lt;br/>"</span><span class="PUNC">+</span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'description'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>799</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>800</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">content.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>801</span> </span><span class="WHIT">    </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>802</span> </span><span class="WHIT">        </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&nbsp;'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>803</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>804</span> </span><span class="WHIT">    </span><span class="NAME">popup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Popup.FramedCloud</span><span class="PUNC">(</span><span class="STRN">"featurePopup"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>805</span> </span><span class="WHIT">                </span><span class="NAME">feature.geometry.getBounds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getCenterLonLat</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>806</span> </span><span class="WHIT">                </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Size</span><span class="PUNC">(</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>807</span> </span><span class="WHIT">                </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">                </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">                    </span><span class="NAME">this.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">                    </span><span class="COMM">// deselect ALL features to be able to select this one again</span><span class="WHIT">
<span class='line'>811</span> </span><span class="WHIT">                    </span><span class="NAME">popup.feature.layer.selectedFeatures</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>812</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">    </span><span class="NAME">feature.popup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">popup</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>815</span> </span><span class="WHIT">    </span><span class="NAME">popup.feature</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">    </span><span class="NAME">this.map.addPopup</span><span class="PUNC">(</span><span class="NAME">popup</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>817</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>818</span> 
<span class='line'>819</span> </span><span class="COMM">/**
<span class='line'>820</span>  * @private
<span class='line'>821</span>  * Click handler for a feature to unselect a feature and close the popup
<span class='line'>822</span>  * Some magic is needed to handle empty popup content
<span class='line'>823</span>  */</span><span class="WHIT">
<span class='line'>824</span> </span><span class="NAME">Pdok.Api.prototype.onPopupFeatureUnselect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">    </span><span class="NAME">feature</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.feature</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">feature.popup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">        </span><span class="NAME">popup.feature</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">        </span><span class="NAME">this.map.removePopup</span><span class="PUNC">(</span><span class="NAME">feature.popup</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">        </span><span class="NAME">feature.popup.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>830</span> </span><span class="WHIT">        </span><span class="NAME">feature.popup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>831</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>832</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>833</span> 
<span class='line'>834</span> </span><span class="COMM">/**
<span class='line'>835</span>  * Api method to disable popups in this Api instance
<span class='line'>836</span>  * @public
<span class='line'>837</span>  */</span><span class="WHIT">
<span class='line'>838</span> </span><span class="NAME">Pdok.Api.prototype.disablePopups</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">        </span><span class="NAME">this.featuresLayer.events.un</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">            </span><span class="STRN">'featureselected'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.onPopupFeatureSelect</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">            </span><span class="STRN">'featureunselected'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.onPopupFeatureUnselect</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>844</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>845</span> </span><span class="COMM">/**
<span class='line'>846</span>  * Api method to enable popups in this Api instance
<span class='line'>847</span>  * @public
<span class='line'>848</span>  */</span><span class="WHIT">
<span class='line'>849</span> </span><span class="NAME">Pdok.Api.prototype.enablePopups</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>850</span> </span><span class="WHIT">        </span><span class="NAME">this.featuresLayer.events.on</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>851</span> </span><span class="WHIT">            </span><span class="STRN">'featureselected'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.onPopupFeatureSelect</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>852</span> </span><span class="WHIT">            </span><span class="STRN">'featureunselected'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.onPopupFeatureUnselect</span><span class="WHIT">
<span class='line'>853</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>855</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>856</span> 
<span class='line'>857</span> </span><span class="COMM">/**
<span class='line'>858</span>  * Returns the current map object of this instance.
<span class='line'>859</span>  * @public
<span class='line'>860</span>  * @return OpenLayer.Map object
<span class='line'>861</span>  */</span><span class="WHIT">
<span class='line'>862</span> </span><span class="NAME">Pdok.Api.prototype.getMapObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.map</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>864</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>865</span> 
<span class='line'>866</span> </span><span class="COMM">/**
<span class='line'>867</span>  * Method to create a feature based on a wkt string and a typestyle (eg mt3), and giving it a title/name and description.
<span class='line'>868</span>  * @depricated only internally used at the moment?
<span class='line'>869</span>  * @param {String} wkt a WKT string for the geometry
<span class='line'>870</span>  * @param {String} typestyle a style id for a defined style (like mt0, mt3, pt0 or lt0)
<span class='line'>871</span>  * @param {String} name a title or name, to be shown as title in the popup
<span class='line'>872</span>  * @param {String} wkt a WKT string for the geometry
<span class='line'>873</span>  * @returns OpenLayers.Feature
<span class='line'>874</span>  */</span><span class="WHIT"> 
<span class='line'>875</span> </span><span class="NAME">Pdok.Api.prototype.createFeature</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">wkt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">typestyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">description</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>876</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wktFormat</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.WKT</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>877</span> </span><span class="WHIT">    </span><span class="COMM">// OpenLayers.Util.getParameters() splits parameters with comma's into an array</span><span class="WHIT">
<span class='line'>878</span> </span><span class="WHIT">    </span><span class="COMM">// because a LINESTRING wkt contains comma we have to concat them back</span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">wkt</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">        </span><span class="NAME">wkt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wkt.join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>881</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>882</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wktFormat.read</span><span class="PUNC">(</span><span class="NAME">wkt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>883</span> </span><span class="WHIT">    </span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'name'</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>884</span> </span><span class="WHIT">    </span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'description'</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">description</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>885</span> </span><span class="WHIT">    </span><span class="COMM">// only if we have this typestyle available</span><span class="WHIT">
<span class='line'>886</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">typestyle</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>887</span> </span><span class="WHIT">        </span><span class="COMM">// TODO check if this style corresponds with the geometry type (eg for points only mt* etc)</span><span class="WHIT">
<span class='line'>888</span> </span><span class="WHIT">        </span><span class="NAME">feature.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">typestyle</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>889</span> </span><span class="WHIT">        </span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'styletype'</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">typestyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>890</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>891</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">feature.geometry.CLASS_NAME</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'OpenLayers.Geometry.Point'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">            </span><span class="NAME">feature.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">'mt0'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>895</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">feature.geometry.CLASS_NAME</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'OpenLayers.Geometry.LineString'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">            </span><span class="NAME">feature.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">'lt0'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>897</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>898</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">feature.geometry.CLASS_NAME</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'OpenLayers.Geometry.Polygon'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">            </span><span class="NAME">feature.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">'pt0'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>900</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>902</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>903</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>904</span> 
<span class='line'>905</span> </span><span class="COMM">/**
<span class='line'>906</span>  * Internal function to create all styles definition into 'this.styles'.
<span class='line'>907</span>  *
<span class='line'>908</span>  * Every geometry type has a default style: mt0, pt0, lt0. They are based on the OpenLayers.Feature.Vector.style['default']-style.
<span class='line'>909</span>  *
<span class='line'>910</span>  * By defining an markerdefs url with style definitions more styles will be created.
<span class='line'>911</span>  */</span><span class="WHIT">
<span class='line'>912</span> </span><span class="NAME">Pdok.Api.prototype.createStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>913</span> 
<span class='line'>914</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">olDefault</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Feature.Vector.style</span><span class="PUNC">[</span><span class="STRN">'default'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>915</span> 
<span class='line'>916</span> </span><span class="WHIT">    </span><span class="NAME">this.styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>917</span> 
<span class='line'>918</span> </span><span class="WHIT">    </span><span class="COMM">// create a default styles for point: mt0, line: lt0 and polygon pt0</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">    </span><span class="COMM">//.these HAVE to be here because there is code depending on the availability of those</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">    </span><span class="COMM">// you can off course override this</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pdokDefaultPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">        </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>923</span> </span><span class="WHIT">            </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'mt0'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>924</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Standaard marker'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">            </span><span class="NAME">externalGraphic</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Pdok.ApiUrl</span><span class="PUNC">+</span><span class="STRN">"/markertypes/document-properties.png"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>926</span> </span><span class="WHIT">            </span><span class="NAME">graphicHeight</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">32</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">            </span><span class="NAME">graphicWidth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">32</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>928</span> </span><span class="WHIT">            </span><span class="NAME">graphicYOffset</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">32</span><span class="WHIT">
<span class='line'>929</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>930</span> </span><span class="WHIT">    </span><span class="NAME">this.styles.mt0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pdokDefaultPoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>931</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pdokDefaultLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>932</span> </span><span class="WHIT">        </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>933</span> </span><span class="WHIT">            </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'lt0'</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>934</span>             </span><span class="NAME">strokeColor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#273397'</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>935</span>             </span><span class="NAME">strokeWidth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">            </span><span class="NAME">strokeOpacity</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>937</span>             </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Standaard lijn'</span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>939</span> </span><span class="WHIT">    </span><span class="NAME">this.styles.lt0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pdokDefaultLine</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pdokDefaultPolygon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>941</span> </span><span class="WHIT">        </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>942</span> </span><span class="WHIT">            </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'pt0'</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>943</span>             </span><span class="NAME">fillColor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#273397'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">            </span><span class="NAME">fillOpacity</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.3</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>945</span>             </span><span class="NAME">strokeColor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#273397'</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>946</span>             </span><span class="NAME">strokeWidth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>947</span>             </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Standaard vlak'</span><span class="WHIT">
<span class='line'>948</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>949</span> </span><span class="WHIT">    </span><span class="NAME">this.styles.pt0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pdokDefaultPolygon</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>950</span> 
<span class='line'>951</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pdokDefaultStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>952</span> </span><span class="WHIT">    </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">        </span><span class="NAME">externalGraphic</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Pdok.ApiUrl</span><span class="PUNC">+</span><span class="STRN">"/markertypes/default.png"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">        </span><span class="NAME">graphicHeight</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">37</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>955</span> </span><span class="WHIT">        </span><span class="NAME">graphicWidth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">32</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>956</span> </span><span class="WHIT">        </span><span class="NAME">graphicYOffset</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">37</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>957</span> </span><span class="WHIT">        </span><span class="NAME">pointRadius</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>958</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>959</span> 
<span class='line'>960</span> </span><span class="WHIT">    </span><span class="COMM">// if the the user added their own styles, they should create a variable 'defaultStyles'</span><span class="WHIT">
<span class='line'>961</span> </span><span class="WHIT">    </span><span class="COMM">// hereby overriding the inbuild defaultStyles</span><span class="WHIT">
<span class='line'>962</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.defaultStyles.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>963</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.defaultStyles</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>964</span> </span><span class="WHIT">        </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">style.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pdokDefaultStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>965</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>966</span> 
<span class='line'>967</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>968</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>969</span> 
<span class='line'>970</span> </span><span class="COMM">/**
<span class='line'>971</span>  * Activating/enabling the Api DrawingTool. Important: based on the first char of the styletype, the type of feature geometry is set: m = marker/point, l = linestring, p = polygon
<span class='line'>972</span>  * 
<span class='line'>973</span>  * It will add a OpenLayers.Control.DrawFeature control to the api, so clicking in the map will generate a feature, to be added in the this.featuresLayer
<span class='line'>974</span>  * 
<span class='line'>975</span>  * @param {String} styletype (eg 'mt1' or 'lt1' or 'pt1') also determining the geometry type
<span class='line'>976</span>  * @param {Function} featureAddedCallback  Function handler to be called after feature is added
<span class='line'>977</span>  */</span><span class="WHIT">
<span class='line'>978</span> </span><span class="NAME">Pdok.Api.prototype.enableDrawingTool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">styletype</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">featureAddedCallback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>979</span> </span><span class="WHIT">    </span><span class="COMM">//console.log('enableDrawingTool start');</span><span class="WHIT">
<span class='line'>980</span> </span><span class="WHIT">    </span><span class="NAME">this.disableDrawingTool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// to be sure we do not have two drawfeature controls active at once</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">apiStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>982</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">apiFeaturesLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.featuresLayer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentDrawControl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">    </span><span class="COMM">// default to mt0 if called without a styletype</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">styletype</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>986</span> </span><span class="WHIT">        </span><span class="NAME">styletype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mt0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>987</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>988</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">styletype</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">'m'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>989</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawFeaturePointControl</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>990</span> </span><span class="WHIT">            </span><span class="NAME">this.drawFeaturePointControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.DrawFeature</span><span class="PUNC">(</span><span class="NAME">this.featuresLayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT">            </span><span class="NAME">this.map.addControl</span><span class="PUNC">(</span><span class="NAME">this.drawFeaturePointControl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.drawFeaturePointControl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>994</span> </span><span class="WHIT">        </span><span class="COMM">//currentDrawControl.handler.style = apiStyles[styletype];</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">styletype</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">'l'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawFeatureLineControl</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">            </span><span class="NAME">this.drawFeatureLineControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.DrawFeature</span><span class="PUNC">(</span><span class="NAME">this.featuresLayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>999</span> </span><span class="WHIT">            </span><span class="NAME">this.map.addControl</span><span class="PUNC">(</span><span class="NAME">this.drawFeatureLineControl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1000</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.drawFeatureLineControl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1002</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl.handler.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">apiStyles</span><span class="PUNC">[</span><span class="NAME">styletype</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl.handler.style.externalGraphic</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">styletype</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">'p'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawFeaturePolygonControl</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">            </span><span class="NAME">this.drawFeaturePolygonControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.DrawFeature</span><span class="PUNC">(</span><span class="NAME">this.featuresLayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Polygon</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">            </span><span class="NAME">this.map.addControl</span><span class="PUNC">(</span><span class="NAME">this.drawFeaturePolygonControl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1010</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.drawFeaturePolygonControl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl.handler.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">apiStyles</span><span class="PUNC">[</span><span class="NAME">styletype</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl.handler.style.externalGraphic</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">    </span><span class="NAME">currentDrawControl.featureAdded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="WHIT">            </span><span class="NAME">feature.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">apiStyles</span><span class="PUNC">[</span><span class="NAME">styletype</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1016</span> </span><span class="WHIT">            </span><span class="COMM">// also set an attribute 'styletype' to be able to export features with styletype</span><span class="WHIT">
<span class='line'>1017</span> </span><span class="WHIT">            </span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'styletype'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">styletype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1018</span> </span><span class="WHIT">            </span><span class="COMM">// we add a name attribute to be able to write to KML (the KML format uses that attribute as name)</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="WHIT">            </span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'name'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&nbsp;'</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// we add &nbsp; here because null or '' will cause the KML writer to not see it as value</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">            </span><span class="NAME">apiFeaturesLayer.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">featureAddedCallback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">                </span><span class="NAME">featureAddedCallback</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1023</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1024</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">    </span><span class="NAME">currentDrawControl.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1027</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1028</span> 
<span class='line'>1029</span> </span><span class="COMM">/**
<span class='line'>1030</span>  * Deactivating/disabling the Api DrawingTool.
<span class='line'>1031</span>  *
<span class='line'>1032</span>  */</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="NAME">Pdok.Api.prototype.disableDrawingTool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="WHIT">    </span><span class="COMM">//console.log('disableDrawingTool');</span><span class="WHIT">
<span class='line'>1035</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawFeaturePointControl</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1036</span> </span><span class="WHIT">        </span><span class="NAME">this.drawFeaturePointControl.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawFeatureLineControl</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">        </span><span class="NAME">this.drawFeatureLineControl.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawFeaturePolygonControl</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">        </span><span class="NAME">this.drawFeaturePolygonControl.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1046</span> 
<span class='line'>1047</span> </span><span class="COMM">/**
<span class='line'>1048</span>  * Deactivating/disabling the Api EditingTool.
<span class='line'>1049</span>  *
<span class='line'>1050</span>  */</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="NAME">Pdok.Api.prototype.disableEditingTool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.editFeatureControl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="WHIT">        </span><span class="NAME">this.editFeatureControl.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1057</span> 
<span class='line'>1058</span> </span><span class="COMM">/**
<span class='line'>1059</span>  * Api method for ctivating/enabling the Api EditingTool.
<span class='line'>1060</span>  * 
<span class='line'>1061</span>  * It will add a OpenLayers.Control.ModifyFeature control to the api, so clicking on a feature in the map will select it and make it editable, and when finished call the featureModifiedFunction
<span class='line'>1062</span>  * 
<span class='line'>1063</span>  * @param {Function} featureModifiedFunction  Function handler to be called when you are ready with changing the geometry
<span class='line'>1064</span>  */</span><span class="WHIT">
<span class='line'>1065</span> </span><span class="NAME">Pdok.Api.prototype.enableEditingTool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">featureModifiedFunction</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1066</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.editFeatureControl</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1067</span> </span><span class="WHIT">        </span><span class="NAME">this.editFeatureControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.ModifyFeature</span><span class="PUNC">(</span><span class="NAME">this.featuresLayer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1068</span> </span><span class="WHIT">        </span><span class="NAME">this.map.addControl</span><span class="PUNC">(</span><span class="NAME">this.editFeatureControl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="WHIT">        </span><span class="COMM">/*featureModifiedFunction = function(ft){
<span class='line'>1070</span>             console.log(ft)
<span class='line'>1071</span>         }
<span class='line'>1072</span>         featureBeforeModifiedFunction = function(ft){
<span class='line'>1073</span>             console.log(ft)
<span class='line'>1074</span>         }*/</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">        </span><span class="NAME">this.featuresLayer.events.on</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="WHIT">              </span><span class="COMM">//"beforefeaturemodified": featureBeforeModifiedFunction,</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="WHIT">              </span><span class="STRN">"beforefeaturemodified"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">featureModifiedFunction</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="WHIT">              </span><span class="STRN">"featuremodified"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">featureModifiedFunction</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1080</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1081</span> </span><span class="WHIT">    </span><span class="NAME">this.editFeatureControl.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1083</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1084</span> 
<span class='line'>1085</span> </span><span class="COMM">/**
<span class='line'>1086</span>  * Api method to set the current center of the map.
<span class='line'>1087</span>  * 
<span class='line'>1088</span>  * @param {Array or Atring} loc An array of two coordinates: like [x,y] OR a commaseparated String with the two coordinates
<span class='line'>1089</span>  */</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="NAME">Pdok.Api.prototype.setLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">loc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="WHIT">    </span><span class="COMM">// if loc is a string like '150000,450000', split</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">loc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">        </span><span class="NAME">loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loc.split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">    </span><span class="NAME">this.map.setCenter</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">loc</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">loc</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1098</span> 
<span class='line'>1099</span> </span><span class="COMM">/**
<span class='line'>1100</span>  * Api method to set the current zoom level of this Api map
<span class='line'>1101</span>  * 
<span class='line'>1102</span>  * @param {integer} zoomlevel the zoomlevel (0 is full map, 14 is fully zoomed in)
<span class='line'>1103</span>  */</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="NAME">Pdok.Api.prototype.setZoomLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">zoomlevel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">    </span><span class="NAME">this.map.zoomTo</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">zoomlevel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1108</span> 
<span class='line'>1109</span> </span><span class="COMM">/**
<span class='line'>1110</span>  * Api helper method to reproject a lat,lon coordinate (epsg:4326/latlon) into an Rijksdriehoekstelsel coordinate (epsg:28992)
<span class='line'>1111</span>  * NOTE: x = lon and y = lat !!
<span class='line'>1112</span>  * returning what is called an OpenLayersLonLat-object, but what is actually a coordinate in RD
<span class='line'>1113</span>  * 
<span class='line'>1114</span>  * @param {double} lat The latitude value (== the y value in epsg:4326)
<span class='line'>1115</span>  * @param {double} lon The longitude value (== the x value in epsg:4326)
<span class='line'>1116</span>  * @returns {OpenLayers.LonLat} the reprojected latlon coordinate actually a RD coordinate
<span class='line'>1117</span>  */</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="NAME">Pdok.Api.prototype.reprojectWGS84toRD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lat</span><span class="PUNC">,</span><span class="NAME">lon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">	</span><span class="NAME">pointRD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.LonLat</span><span class="PUNC">(</span><span class="NAME">lon</span><span class="PUNC">,</span><span class="NAME">lat</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">transform</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1121</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="STRN">"EPSG:4326"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// transform from wgs84 </span><span class="WHIT">
<span class='line'>1122</span> </span><span class="WHIT">            </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="STRN">"EPSG:28992"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// new RD</span><span class="WHIT">
<span class='line'>1123</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1124</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">pointRD</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1125</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1126</span> 
<span class='line'>1127</span> </span><span class="COMM">/**
<span class='line'>1128</span>  * Generic api method to add an already constructed OpenLayers layer 
<span class='line'>1129</span>  * to our map. 
<span class='line'>1130</span>  * The use of this method guarantees you that locationLayer and featureLayer 
<span class='line'>1131</span>  * are always on top
<span class='line'>1132</span>  * Can be used to add an external layer to the map.
<span class='line'>1133</span>  * @param {OpenLayer.Layer} a valid OpenLayers.Layer layer
<span class='line'>1134</span>  */</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="NAME">Pdok.Api.prototype.addOLLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">openLayersLayer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="WHIT">    </span><span class="NAME">this.map.addLayer</span><span class="PUNC">(</span><span class="NAME">openLayersLayer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1137</span> </span><span class="WHIT">    </span><span class="NAME">this.moveVectorLayersToTop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1139</span> 
<span class='line'>1140</span> </span><span class="COMM">/**
<span class='line'>1141</span>  * Api method to add a TMS layer to the map, based on three strings
<span class='line'>1142</span>  * 
<span class='line'>1143</span>  * @param {String} tmsurl a valid URL string
<span class='line'>1144</span>  * @param {String} tmslayer a valid layername of the above tmsurl service
<span class='line'>1145</span>  * @param {String} tmstype Optional tmstype, defaulting to 'png'
<span class='line'>1146</span>  */</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="NAME">Pdok.Api.prototype.addTMS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tmsurl</span><span class="PUNC">,</span><span class="NAME">tmslayer</span><span class="PUNC">,</span><span class="NAME">tmstype</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1148</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tmstype</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1149</span> </span><span class="WHIT">        </span><span class="NAME">tmstype</span><span class="PUNC">=</span><span class="STRN">"png"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1150</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1151</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lyrTMS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createTMSLayer</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1152</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tmsurl</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1153</span> </span><span class="WHIT">            </span><span class="NAME">layername</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tmslayer</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1154</span> </span><span class="WHIT">            </span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tmstype</span><span class="WHIT">
<span class='line'>1155</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="WHIT">    </span><span class="NAME">this.addOLLayer</span><span class="PUNC">(</span><span class="NAME">lyrTMS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1157</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1158</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1159</span> 
<span class='line'>1160</span> </span><span class="COMM">/**
<span class='line'>1161</span>  * Method to create a TMS layer and add it to the map based on a layer configuration object. Normally you'll use the addTMS method, but you can also use this way.
<span class='line'>1162</span>  * @param {Object} layerConfigObj a layer configuration object as described in markersdef
<span class='line'>1163</span>  */</span><span class="WHIT">
<span class='line'>1164</span> </span><span class="NAME">Pdok.Api.prototype.createTMSLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layerConfigObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1165</span> 
<span class='line'>1166</span> </span><span class="WHIT">    </span><span class="COMM">// default TMS layer object to set defaults:</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">    </span><span class="COMM">// missing values in config object will be replaced by sensible defaults:</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'tms layer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="WHIT">            </span><span class="NAME">layertype</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="WHIT">            </span><span class="NAME">layername</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1173</span> </span><span class="WHIT">            </span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'png'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1174</span> </span><span class="WHIT">            </span><span class="NAME">visibility</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1175</span> </span><span class="WHIT">            </span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1176</span> </span><span class="WHIT">			</span><span class="NAME">attribution</span><span class="PUNC">:</span><span class="STRN">''</span><span class="WHIT">
<span class='line'>1177</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1178</span> 
<span class='line'>1179</span> </span><span class="WHIT">    </span><span class="NAME">layerConfigObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">layerConfigObj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">defaults</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1180</span> 
<span class='line'>1181</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.TMS</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1182</span> </span><span class="WHIT">        </span><span class="NAME">layerConfigObj.name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1183</span> </span><span class="WHIT">        </span><span class="NAME">layerConfigObj.url</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1184</span> </span><span class="WHIT">        </span><span class="PUNC">{</span><span class="WHIT">   </span><span class="NAME">layername</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.layername</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>1185</span>             </span><span class="NAME">type</span><span class="PUNC">:</span><span class="NAME">layerConfigObj.type</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>1186</span>             </span><span class="NAME">visibility</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.visibility</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>1187</span>             </span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.isBaseLayer</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1188</span> </span><span class="WHIT">			</span><span class="NAME">attribution</span><span class="PUNC">:</span><span class="NAME">layerConfigObj.attribution</span><span class="WHIT">
<span class='line'>1189</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="WHIT">    </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1191</span> 
<span class='line'>1192</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1193</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1194</span> 
<span class='line'>1195</span> </span><span class="COMM">/**
<span class='line'>1196</span>  * Api method to add a WMTS layer to the map, based on five strings
<span class='line'>1197</span>  * 
<span class='line'>1198</span>  * @param {String} wmtsurl a valid URL string
<span class='line'>1199</span>  * @param {String} wmtslayer a valid layername of the above tmsurl service
<span class='line'>1200</span>  * @param {String} wmtsmatrixset a valid matrixset id
<span class='line'>1201</span>  * @param {String} wmtsstyle a valid style (defaults to 'default')
<span class='line'>1202</span>  * @param {String} wmtsmatrixids (optional) will be created
<span class='line'>1203</span>  */</span><span class="WHIT">
<span class='line'>1204</span> </span><span class="NAME">Pdok.Api.prototype.addWMTS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">wmtsurl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wmtslayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wmtsmatrixset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wmtsstyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wmtsmatrixids</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1205</span> </span><span class="WHIT">    </span><span class="NAME">this.wmtsurl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wmtsurl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1206</span> </span><span class="WHIT">    </span><span class="NAME">this.wmtslayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wmtslayer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1207</span> </span><span class="WHIT">    </span><span class="NAME">this.wmtsmatrixset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wmtsmatrixset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1208</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lyrWMTS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createWMTSLayer</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1209</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">wmtslayer</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1210</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">wmtsurl</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1211</span> </span><span class="WHIT">            </span><span class="NAME">layer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">wmtslayer</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">            </span><span class="NAME">matrixSet</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">wmtsmatrixset</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1213</span> </span><span class="WHIT">            </span><span class="NAME">matrixIds</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">wmtsmatrixids</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="WHIT">            </span><span class="NAME">style</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">wmtsstyle</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1216</span> </span><span class="WHIT">    </span><span class="NAME">this.addOLLayer</span><span class="PUNC">(</span><span class="NAME">lyrWMTS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1219</span> 
<span class='line'>1220</span> </span><span class="COMM">/**
<span class='line'>1221</span>  * Method to create a WMTS layer and add it to the map based on a layer configuration object. Normally you'll use the addWMTS method, but you can also use this way.
<span class='line'>1222</span>  * @param {Object} layerConfigObj a layer configuration object as described in markersdef
<span class='line'>1223</span>  */</span><span class="WHIT">
<span class='line'>1224</span> </span><span class="NAME">Pdok.Api.prototype.createWMTSLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layerConfigObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="WHIT">    </span><span class="COMM">// From WMTS openlayers example:</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="WHIT">    </span><span class="COMM">// If tile matrix identifiers differ from zoom levels (0, 1, 2, ...)</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="WHIT">    </span><span class="COMM">// then they must be explicitly provided.</span><span class="WHIT">
<span class='line'>1228</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">matrixIds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NUMB">26</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1229</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">26</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="WHIT">        </span><span class="NAME">matrixIds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.matrixSet</span><span class="PUNC">+</span><span class="STRN">':'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1232</span> 
<span class='line'>1233</span> </span><span class="WHIT">    </span><span class="COMM">// default WMTS layer object to set defaults:</span><span class="WHIT">
<span class='line'>1234</span> </span><span class="WHIT">    </span><span class="COMM">// missing values in config object will be replaced by sensible defaults:</span><span class="WHIT">
<span class='line'>1235</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1236</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'wmts layer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1237</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1238</span> </span><span class="WHIT">            </span><span class="NAME">layer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1239</span> </span><span class="WHIT">            </span><span class="NAME">style</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'default'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">            </span><span class="NAME">matrixSet</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="WHIT">            </span><span class="NAME">matrixIds</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">matrixIds</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="WHIT">            </span><span class="NAME">visibility</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="WHIT">            </span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="WHIT">            </span><span class="NAME">format</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'image/png8'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1245</span> </span><span class="WHIT">            </span><span class="NAME">attribution</span><span class="PUNC">:</span><span class="STRN">''</span><span class="WHIT">
<span class='line'>1246</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1247</span> 
<span class='line'>1248</span> </span><span class="WHIT">    </span><span class="NAME">layerConfigObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">layerConfigObj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">defaults</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1249</span> 
<span class='line'>1250</span> </span><span class="WHIT">     </span><span class="COMM">/* var wmts = new OpenLayers.Layer.WMTS({
<span class='line'>1251</span>      *     name: "My WMTS Layer",
<span class='line'>1252</span>      *     url: "http://example.com/wmts",·
<span class='line'>1253</span>      *     layer: "layer_id",
<span class='line'>1254</span>      *     style: "default",
<span class='line'>1255</span>      *     matrixSet: "matrix_id"
<span class='line'>1256</span>      * });
<span class='line'>1257</span>      */</span><span class="WHIT">
<span class='line'>1258</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.WMTS</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1259</span> </span><span class="WHIT">        </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="NAME">layerConfigObj.url</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1262</span> </span><span class="WHIT">            </span><span class="NAME">layer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.layer</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1263</span> </span><span class="WHIT">            </span><span class="NAME">style</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.style</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1264</span> </span><span class="WHIT">            </span><span class="NAME">matrixSet</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.matrixSet</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1265</span> </span><span class="WHIT">            </span><span class="NAME">matrixIds</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.matrixIds</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1266</span> </span><span class="WHIT">            </span><span class="NAME">format</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.format</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="WHIT">            </span><span class="NAME">visibility</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.visibility</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1268</span> </span><span class="WHIT">            </span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.isBaseLayer</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1269</span> </span><span class="WHIT">            </span><span class="NAME">attribution</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.attribution</span><span class="WHIT">
<span class='line'>1270</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1271</span> </span><span class="WHIT">    </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1272</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1273</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1274</span> 
<span class='line'>1275</span> </span><span class="COMM">/**
<span class='line'>1276</span>  * Api method to add a WMS layer to the map, based on two strings
<span class='line'>1277</span>  * 
<span class='line'>1278</span>  * @param {String} wmsurl a valid URL string
<span class='line'>1279</span>  * @param {String} wmslayers a valid layername of the above url service
<span class='line'>1280</span>  */</span><span class="WHIT">
<span class='line'>1281</span> </span><span class="NAME">Pdok.Api.prototype.addWMS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">wmsurl</span><span class="PUNC">,</span><span class="NAME">wmslayers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">    </span><span class="NAME">this.wmsurl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wmsurl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">    </span><span class="NAME">this.wmslayers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wmslayers</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lyrWMS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createWMSLayer</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1285</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">wmsurl</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1286</span> </span><span class="WHIT">            </span><span class="NAME">layers</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">wmslayers</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1287</span> </span><span class="WHIT">            </span><span class="NAME">transparent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>1288</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1289</span> </span><span class="WHIT">    </span><span class="NAME">this.addOLLayer</span><span class="PUNC">(</span><span class="NAME">lyrWMS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1290</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1291</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1292</span> 
<span class='line'>1293</span> 
<span class='line'>1294</span> </span><span class="COMM">/**
<span class='line'>1295</span>  * Method to create a WMS layer and add it to the map based on a layer configuration object. Normally you'll use the addWMS method, but you can also use this way.
<span class='line'>1296</span>  * @param {Object} layerConfigObj a layer configuration object as described in markersdef
<span class='line'>1297</span>  */</span><span class="WHIT">
<span class='line'>1298</span> </span><span class="NAME">Pdok.Api.prototype.createWMSLayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">layerConfigObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1299</span> 
<span class='line'>1300</span> </span><span class="WHIT">    </span><span class="COMM">// default WMS layer object to set defaults:</span><span class="WHIT">
<span class='line'>1301</span> </span><span class="WHIT">    </span><span class="COMM">// missing values in config object will be replaced by sensible defaults:</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1303</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'WMS layer'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1304</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1305</span> </span><span class="WHIT">            </span><span class="NAME">layers</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1306</span> </span><span class="WHIT">            </span><span class="NAME">styles</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1307</span> </span><span class="WHIT">            </span><span class="NAME">visibility</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1308</span> </span><span class="WHIT">            </span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1309</span> </span><span class="WHIT">            </span><span class="NAME">format</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'image/png'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1310</span> </span><span class="WHIT">            </span><span class="NAME">singleTile</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1311</span> </span><span class="WHIT">			</span><span class="NAME">attribution</span><span class="PUNC">:</span><span class="STRN">''</span><span class="WHIT">
<span class='line'>1312</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1313</span> 
<span class='line'>1314</span> </span><span class="WHIT">    </span><span class="NAME">layerConfigObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Util.applyDefaults</span><span class="PUNC">(</span><span class="NAME">layerConfigObj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">defaults</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1315</span> 
<span class='line'>1316</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Layer.WMS</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1317</span> </span><span class="WHIT">            </span><span class="NAME">layerConfigObj.name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1318</span> </span><span class="WHIT">            </span><span class="NAME">layerConfigObj.url</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1319</span> </span><span class="WHIT">            </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1320</span> </span><span class="WHIT">                </span><span class="NAME">layers</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.layers</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>1321</span>                 </span><span class="NAME">transparent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.transparent</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>1322</span>                 </span><span class="NAME">format</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.format</span><span class="WHIT">
<span class='line'>1323</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1324</span> </span><span class="WHIT">            </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1325</span> </span><span class="WHIT">                </span><span class="NAME">visibility</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.visibility</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>1326</span>                 </span><span class="NAME">isBaseLayer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.isBaseLayer</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>1327</span>                 </span><span class="NAME">singleTile</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">layerConfigObj.singleTile</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1328</span> </span><span class="WHIT">				</span><span class="NAME">attribution</span><span class="PUNC">:</span><span class="NAME">layerConfigObj.attribution</span><span class="WHIT"> 
<span class='line'>1329</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1330</span> </span><span class="WHIT">    </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1331</span> 
<span class='line'>1332</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1334</span> 
<span class='line'>1335</span> </span><span class="COMM">/**
<span class='line'>1336</span>  * Api Interface addLayers to add layers the map, based on their layerkey-names Eg: 'BRT,TOP10NL2,CBS_PROVINCIES'
<span class='line'>1337</span>  * @param {array} An javascript array of layer names
<span class='line'>1338</span>  * @param {OpenLayers.Map} the Pdok.Api-map to add the layers to
<span class='line'>1339</span>  */</span><span class="WHIT">
<span class='line'>1340</span> </span><span class="NAME">Pdok.Api.prototype.addLayers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">arrLayerNames</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1341</span> 
<span class='line'>1342</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arrLayerNames</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">'null object as layernames'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1344</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1345</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1346</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arrLayerNames</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1347</span> </span><span class="WHIT">        </span><span class="COMM">// this is the 'header' of the selectbox: "choose ..."</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1350</span> 
<span class='line'>1351</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">map</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">        </span><span class="NAME">map</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.map</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1354</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">arrLayerNames</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="WHIT">    </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1356</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layerId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrLayerNames</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1357</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.defaultLayers</span><span class="PUNC">[</span><span class="NAME">layerId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lyr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1359</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.defaultLayers</span><span class="PUNC">[</span><span class="NAME">layerId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">layertype.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'WMS'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1360</span> </span><span class="WHIT">                </span><span class="NAME">lyr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createWMSLayer</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.defaultLayers</span><span class="PUNC">[</span><span class="NAME">layerId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1361</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1362</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.defaultLayers</span><span class="PUNC">[</span><span class="NAME">layerId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">layertype.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'WMTS'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1363</span> </span><span class="WHIT">                </span><span class="NAME">lyr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createWMTSLayer</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.defaultLayers</span><span class="PUNC">[</span><span class="NAME">layerId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1364</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1365</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.defaultLayers</span><span class="PUNC">[</span><span class="NAME">layerId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">layertype.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'TMS'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1366</span> </span><span class="WHIT">                </span><span class="NAME">lyr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createTMSLayer</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.defaultLayers</span><span class="PUNC">[</span><span class="NAME">layerId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1367</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1368</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1369</span> </span><span class="WHIT">                </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">'layertype not available (wrong config?): '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.defaultLayers.l.layertype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1370</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lyr</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">                </span><span class="NAME">lyr.pdokId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">layerId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">                </span><span class="NAME">map.addLayer</span><span class="PUNC">(</span><span class="NAME">lyr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1375</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1376</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1377</span> </span><span class="WHIT">            </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">'layerid not available: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">layerId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1378</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">    </span><span class="COMM">// to be sure featuresLayer and locationLayer are always on top</span><span class="WHIT">
<span class='line'>1381</span> </span><span class="WHIT">    </span><span class="NAME">this.moveVectorLayersToTop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1382</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1383</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1384</span> 
<span class='line'>1385</span> </span><span class="COMM">/**
<span class='line'>1386</span>  * Move the featuresLayer and the locationLayer (layer used by the locationTool) to the top after adding other layers.
<span class='line'>1387</span>  */</span><span class="WHIT">
<span class='line'>1388</span> </span><span class="NAME">Pdok.Api.prototype.moveVectorLayersToTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">    </span><span class="COMM">// TODO ??take all vector layers into account??</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.featuresLayer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">        </span><span class="NAME">this.map.setLayerIndex</span><span class="PUNC">(</span><span class="NAME">this.featuresLayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.map.layers.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.locationLayer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1394</span> </span><span class="WHIT">        </span><span class="NAME">this.map.setLayerIndex</span><span class="PUNC">(</span><span class="NAME">this.locationLayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.map.layers.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1397</span> 
<span class='line'>1398</span> 
<span class='line'>1399</span> </span><span class="COMM">/**
<span class='line'>1400</span>  * Api method to disable the locationTool (actually deactivate all needed OpenLayers controls)
<span class='line'>1401</span>  */</span><span class="WHIT">
<span class='line'>1402</span> </span><span class="NAME">Pdok.Api.prototype.disableLocationTool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1403</span> 
<span class='line'>1404</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawLocationPointControl</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">        </span><span class="NAME">this.drawLocationPointControl.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1406</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1407</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawLocationLineControl</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">        </span><span class="NAME">this.drawLocationLineControl.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1409</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1410</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawLocationPolygonControl</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">        </span><span class="NAME">this.drawLocationPolygonControl.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1415</span> 
<span class='line'>1416</span> </span><span class="COMM">/**
<span class='line'>1417</span>  * Api method to set the api location properties, detached from starting of the
<span class='line'>1418</span>  * locationtool to be able to only configure the tool within the wizard
<span class='line'>1419</span>  * @param {String} styletype a styletype string like mt0 
<span class='line'>1420</span>  * @param {int} zmin the minimal zoom level the user can click
<span class='line'>1421</span>  * @param {int} zmaxt the maximal zoom level the user can click
<span class='line'>1422</span>  * @param {String} xorwkt the name of the field to be used as X-field OR WKT-field (in this case you should not define y)
<span class='line'>1423</span>  * @param {String} y the name of the field to be used as Y-field (without setting this one the tool will only set WKT field)
<span class='line'>1424</span>  */</span><span class="WHIT">
<span class='line'>1425</span> 
<span class='line'>1426</span> </span><span class="NAME">Pdok.Api.prototype.setLocationToolProps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">styletype</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">zmin</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">zmax</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xorwkt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1427</span> 
<span class='line'>1428</span> </span><span class="WHIT">    </span><span class="COMM">//console.log('setting locationtoolprops: '+styletype+' '+zmin+' '+ zmax+' '+ xorwkt+' '+y);</span><span class="WHIT">
<span class='line'>1429</span> </span><span class="WHIT">    </span><span class="NAME">this.locationtool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1430</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">styletype</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1431</span> </span><span class="WHIT">        </span><span class="NAME">this.locationtoolstyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">styletype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1432</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1433</span> </span><span class="WHIT">    </span><span class="COMM">// if y is defined, this function is called with an x and y field</span><span class="WHIT">
<span class='line'>1434</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1435</span> </span><span class="WHIT">        </span><span class="NAME">this.locationtoolxfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xorwkt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1436</span> </span><span class="WHIT">        </span><span class="NAME">this.locationtoolyfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1437</span> </span><span class="WHIT">        </span><span class="NAME">this.locationtoolwktfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// NO wkt</span><span class="WHIT">
<span class='line'>1438</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1439</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">xorwkt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1440</span> </span><span class="WHIT">        </span><span class="COMM">// apparently only a wkt field</span><span class="WHIT">
<span class='line'>1441</span> </span><span class="WHIT">        </span><span class="NAME">this.locationtoolxfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1442</span> </span><span class="WHIT">        </span><span class="NAME">this.locationtoolyfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1443</span> </span><span class="WHIT">        </span><span class="NAME">this.locationtoolwktfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xorwkt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1444</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">        </span><span class="COMM">// default to x y field from api defaults</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">        </span><span class="NAME">this.locationtoolwktfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// NO wkt</span><span class="WHIT">
<span class='line'>1448</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">    </span><span class="COMM">// be carefull not to use if(zmin) or if(zmax), they can be 0 (which solves to false)</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">zmin</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">        </span><span class="NAME">this.locationtoolzmin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">zmin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">zmax</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1454</span> </span><span class="WHIT">        </span><span class="NAME">this.locationtoolzmax</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">zmax</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1455</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1457</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1458</span> 
<span class='line'>1459</span> 
<span class='line'>1460</span> </span><span class="COMM">/**
<span class='line'>1461</span>  * Api method to UNset the locationtool, and set the api location properties to default values
<span class='line'>1462</span>  * this is necceary to be able to create code and a map link with or without the locationtool-props
<span class='line'>1463</span>  *
<span class='line'>1464</span>  */</span><span class="WHIT">
<span class='line'>1465</span> </span><span class="NAME">Pdok.Api.prototype.removeLocationToolProps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1466</span> </span><span class="WHIT">    </span><span class="COMM">//console.log('remove locationtoolprops');</span><span class="WHIT">
<span class='line'>1467</span> </span><span class="WHIT">    </span><span class="COMM">// back to defaults</span><span class="WHIT">
<span class='line'>1468</span> </span><span class="WHIT">    </span><span class="NAME">this.locationtool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1469</span> </span><span class="WHIT">    </span><span class="NAME">this.locationtoolstyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mt0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1470</span> </span><span class="WHIT">    </span><span class="NAME">this.locationtoolxfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'x'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1471</span> </span><span class="WHIT">    </span><span class="NAME">this.locationtoolyfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'y'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1472</span> </span><span class="WHIT">    </span><span class="NAME">this.locationtoolwktfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'wkt'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1473</span> </span><span class="WHIT">    </span><span class="NAME">this.locationtoolzmin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="WHIT">    </span><span class="NAME">this.locationtoolzmax</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'30'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1475</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1476</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1477</span> 
<span class='line'>1478</span> </span><span class="COMM">/**
<span class='line'>1479</span>  * Enable the location tool. Either use all locationtool defaults, OR set them via setLocationToolProps method.
<span class='line'>1480</span>  */</span><span class="WHIT">
<span class='line'>1481</span> </span><span class="NAME">Pdok.Api.prototype.enableLocationTool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1482</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">apiObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1483</span> 
<span class='line'>1484</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">alerted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1485</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">locationToolCheck</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1486</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">apiObject.locationLayer.features.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">            </span><span class="COMM">// stop all locationtool controls</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">confirm</span><span class="PUNC">(</span><span class="STRN">'Er is al een geldige lokatie. \nKlik OK om verder te gaan,\nof Annuleren/Cancel om opnieuw te klikken.'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">                </span><span class="NAME">apiObject.map.events.unregister</span><span class="PUNC">(</span><span class="STRN">"moveend"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">apiObject.map</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">locationToolCheck</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1490</span> </span><span class="WHIT">                </span><span class="NAME">apiObject.map.events.unregister</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">apiObject.map</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">locationToolCheck</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1491</span> </span><span class="WHIT">                </span><span class="NAME">apiObject.disableLocationTool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1492</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1494</span> </span><span class="WHIT">                </span><span class="NAME">apiObject.locationLayer.removeAllFeatures</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1495</span> </span><span class="WHIT">                </span><span class="NAME">apiObject.removeFormCoordinates</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1496</span> </span><span class="WHIT">                </span><span class="NAME">apiObject.startLocationTool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1499</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1500</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">apiObject.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">apiObject.locationtoolzmin</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">apiObject.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">apiObject.locationtoolzmax</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1501</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">apiObject.locationtoolstyle</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1502</span> </span><span class="WHIT">                </span><span class="NAME">apiObject.locationtoolstyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mt0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1503</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1504</span> </span><span class="WHIT">            </span><span class="NAME">apiObject.startLocationTool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1505</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"U kunt alleen tekenen tussen de zoomnivo's: "</span><span class="PUNC">+</span><span class="NAME">apiObject.locationtoolzmin</span><span class="PUNC">+</span><span class="STRN">" en "</span><span class="PUNC">+</span><span class="NAME">apiObject.locationtoolzmax</span><span class="PUNC">+</span><span class="STRN">". \nU zit nu op zoomnivo: "</span><span class="PUNC">+</span><span class="NAME">apiObject.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">apiObject.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">apiObject.locationtoolzmin</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1509</span> </span><span class="WHIT">                </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\nKlik op OK om "</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolzmin</span><span class="PUNC">-</span><span class="NAME">apiObject.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">" zoomnivo's in te zoomen \n(of Annuleren/Cancel om het zelf te doen)"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">                </span><span class="NAME">zoom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">apiObject.locationtoolzmin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1512</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1513</span> </span><span class="WHIT">                </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\nKlik op OK om "</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">apiObject.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">apiObject.locationtoolzmax</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">" zoomnivo's uit te zoomen \n(of Annuleren/Cancel om het zelf te doen)"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1514</span> </span><span class="WHIT">                </span><span class="NAME">zoom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">apiObject.locationtoolzmax</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1515</span> 
<span class='line'>1516</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1517</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">alerted</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">                </span><span class="COMM">//alerted = true;</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">confirm</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1520</span> </span><span class="WHIT">                    </span><span class="NAME">apiObject.map.zoomTo</span><span class="PUNC">(</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1521</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1523</span> </span><span class="WHIT">                    </span><span class="NAME">apiObject.disableLocationTool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">    </span><span class="COMM">// register above check function to listen to moveend en click events of the map</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">    </span><span class="NAME">this.map.events.register</span><span class="PUNC">(</span><span class="STRN">"moveend"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.map</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">locationToolCheck</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1530</span> </span><span class="WHIT">    </span><span class="NAME">this.map.events.register</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.map</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">locationToolCheck</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1531</span> </span><span class="WHIT">    </span><span class="COMM">// first check</span><span class="WHIT">
<span class='line'>1532</span> </span><span class="WHIT">    </span><span class="NAME">locationToolCheck</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1533</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1534</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1535</span> 
<span class='line'>1536</span> </span><span class="COMM">/**
<span class='line'>1537</span>  * Clean up the locationtool form inputs
<span class='line'>1538</span>  */</span><span class="WHIT">
<span class='line'>1539</span> </span><span class="NAME">Pdok.Api.prototype.removeFormCoordinates</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">apiObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolxfield</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">apiObject.locationtoolyfield</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="WHIT">		</span><span class="NAME">apiObject</span><span class="PUNC">[</span><span class="NAME">apiObject.locationtoolxfield</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">		</span><span class="NAME">apiObject</span><span class="PUNC">[</span><span class="NAME">apiObject.locationtoolyfield</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolxfield</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolyfield</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">			</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolxfield</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">			</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolyfield</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT">
<span class='line'>1547</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1548</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolwktfield</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1550</span> </span><span class="WHIT">		</span><span class="NAME">apiObject</span><span class="PUNC">[</span><span class="NAME">apiObject.locationtoolwktfield</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1551</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolwktfield</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">			</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolwktfield</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1553</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1554</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1556</span> 
<span class='line'>1557</span> </span><span class="COMM">/**
<span class='line'>1558</span>  * Start the locationtool
<span class='line'>1559</span>  */</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="NAME">Pdok.Api.prototype.startLocationTool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">    </span><span class="NAME">this.disableLocationTool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// to be sure we do not have two drawfeature controls active at once</span><span class="WHIT">
<span class='line'>1562</span> 
<span class='line'>1563</span> </span><span class="WHIT">    </span><span class="COMM">// selectControl and popups interfere with editing tools: disable all</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">    </span><span class="NAME">this.selectControl.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1565</span> </span><span class="WHIT">    </span><span class="NAME">this.disablePopups</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1566</span> 
<span class='line'>1567</span> </span><span class="WHIT">    </span><span class="COMM">// create controls</span><span class="WHIT">
<span class='line'>1568</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentDrawControl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.locationtoolstyle</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">        </span><span class="NAME">this.locationtoolstyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mt0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1572</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.locationtoolstyle.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'m'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawLocationPointControl</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="WHIT">            </span><span class="NAME">this.drawLocationPointControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.DrawFeature</span><span class="PUNC">(</span><span class="NAME">this.locationLayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="WHIT">            </span><span class="NAME">this.map.addControl</span><span class="PUNC">(</span><span class="NAME">this.drawLocationPointControl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1576</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.drawLocationPointControl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="WHIT">        </span><span class="COMM">//currentDrawControl.handler.style = this.styles[this.locationtoolstyle];</span><span class="WHIT">
<span class='line'>1579</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1580</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.locationtoolstyle.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'l'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawLocationLineControl</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1582</span> </span><span class="WHIT">            </span><span class="NAME">this.drawLocationLineControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.DrawFeature</span><span class="PUNC">(</span><span class="NAME">this.locationLayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1583</span> </span><span class="WHIT">            </span><span class="NAME">this.map.addControl</span><span class="PUNC">(</span><span class="NAME">this.drawLocationLineControl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1584</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1585</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.drawLocationLineControl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1586</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl.handler.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">this.locationtoolstyle</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1587</span> </span><span class="WHIT">        </span><span class="COMM">//currentDrawControl.handler.style.externalGraphic = null;</span><span class="WHIT">
<span class='line'>1588</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1589</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.locationtoolstyle.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'p'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1590</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.drawLocationPolygonControl</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1591</span> </span><span class="WHIT">            </span><span class="NAME">this.drawLocationPolygonControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Control.DrawFeature</span><span class="PUNC">(</span><span class="NAME">this.locationLayer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Handler.Polygon</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1592</span> </span><span class="WHIT">            </span><span class="NAME">this.map.addControl</span><span class="PUNC">(</span><span class="NAME">this.drawLocationPolygonControl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1593</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1594</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.drawLocationPolygonControl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1595</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl.handler.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">this.locationtoolstyle</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1596</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl.handler.style.externalGraphic</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1597</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1598</span> 
<span class='line'>1599</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">apiObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1600</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">locationtoolfeatureadded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1601</span> </span><span class="WHIT">        </span><span class="COMM">// sometimes we receive an event object (with a feature)</span><span class="WHIT">
<span class='line'>1602</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">feature.feature</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1603</span> </span><span class="WHIT">            </span><span class="NAME">feature</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">feature.feature</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1604</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1605</span> </span><span class="WHIT">        </span><span class="NAME">feature.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">apiObject.styles</span><span class="PUNC">[</span><span class="NAME">apiObject.locationtoolstyle</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1606</span> </span><span class="WHIT">        </span><span class="NAME">feature.layer.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1607</span> </span><span class="WHIT">        </span><span class="COMM">// also set an attribute 'styletype' to be able to export features with styletype</span><span class="WHIT">
<span class='line'>1608</span> </span><span class="WHIT">        </span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'styletype'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">apiObject.locationtoolstyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1609</span> 
<span class='line'>1610</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wktFormat</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.WKT</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1611</span> 
<span class='line'>1612</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolxfield</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">apiObject.locationtoolyfield</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1613</span> </span><span class="WHIT">            </span><span class="NAME">apiObject</span><span class="PUNC">[</span><span class="NAME">apiObject.locationtoolxfield</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">feature.geometry.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1614</span> </span><span class="WHIT">            </span><span class="NAME">apiObject</span><span class="PUNC">[</span><span class="NAME">apiObject.locationtoolyfield</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">feature.geometry.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1615</span> </span><span class="WHIT">            </span><span class="COMM">// only for points</span><span class="WHIT">
<span class='line'>1616</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">feature.geometry.x</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">feature.geometry.y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1617</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolxfield</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolyfield</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">                    </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolxfield</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">feature.geometry.x</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">                    </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolyfield</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">feature.geometry.y</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1623</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolwktfield</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1624</span> </span><span class="WHIT">            </span><span class="NAME">apiObject</span><span class="PUNC">[</span><span class="NAME">apiObject.locationtoolwktfield</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wktFormat.write</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1625</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolwktfield</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">                </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">apiObject.locationtoolwktfield</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wktFormat.write</span><span class="PUNC">(</span><span class="NAME">feature</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1628</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1629</span> </span><span class="WHIT">        </span><span class="NAME">currentDrawControl.deactivate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1630</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1631</span> 
<span class='line'>1632</span> </span><span class="WHIT">    </span><span class="NAME">currentDrawControl.featureAdded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">locationtoolfeatureadded</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1633</span> </span><span class="WHIT">    </span><span class="NAME">currentDrawControl.activate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1634</span> 
<span class='line'>1635</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1636</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1637</span> 
<span class='line'>1638</span> </span><span class="COMM">/**
<span class='line'>1639</span>  * @private
<span class='line'>1640</span>  * handle the response to retrieve external features via an ajax request (kml etc)
<span class='line'>1641</span>  */</span><span class="WHIT">
<span class='line'>1642</span> </span><span class="NAME">Pdok.Api.prototype.handleGetFeaturesResponse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">response</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1643</span> </span><span class="WHIT">    </span><span class="COMM">//  trying to catch proxy errors</span><span class="WHIT">
<span class='line'>1644</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">response.status</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">502</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">response.status</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">403</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1645</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">'Fout bij het ophalen van de url.\nDit lijkt een proxy probleem.\nKomt de data van een ander domein dan de web applicatie?\nDan moet het data domein opgenomen worden in de proxy-instellingen.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT">
<span class='line'>1647</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1648</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">response.status</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1649</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">'Fout bij het ophalen van de url\n(Let op: een externe url moet met \'http://\' beginnen) '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1650</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT">
<span class='line'>1651</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1652</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">response.responseText</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1653</span> </span><span class="WHIT">    </span><span class="COMM">// we have data now: add to map</span><span class="WHIT">
<span class='line'>1654</span> </span><span class="WHIT">    </span><span class="NAME">api.addFeaturesFromString</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.dataType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.zoomToFeatures</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1655</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1656</span> 
<span class='line'>1657</span> </span><span class="COMM">/**
<span class='line'>1658</span>  * Add features via a String. Either KML or TXT format
<span class='line'>1659</span>  * @param {String} data actual string of data
<span class='line'>1660</span>  * @param {String} type String one of 'KML' or 'TXT'
<span class='line'>1661</span>  * @param {Boolean} zoomToFeatures boolean to determine if we should zoom to the extent of the just added features
<span class='line'>1662</span>  */</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="NAME">Pdok.Api.prototype.addFeaturesFromString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">zoomToFeatures</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">format</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">        </span><span class="NAME">externalProjection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="STRN">"EPSG:4326"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="WHIT">        </span><span class="NAME">internalProjection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.map.baseLayer.projection</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1669</span> </span><span class="WHIT">        </span><span class="NAME">extractStyles</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.kmlstyles</span><span class="WHIT">
<span class='line'>1670</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'KML'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1672</span> </span><span class="WHIT">        </span><span class="NAME">format</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.KML</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1673</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.search</span><span class="PUNC">(</span><span class="REGX">/\n/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">data.search</span><span class="PUNC">(</span><span class="REGX">/\n/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">data.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1674</span> </span><span class="WHIT">        	</span><span class="COMM">//alert("Er zijn returns gevonden in de KML, deze zijn vervangen door een spatie.")</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="WHIT">        	</span><span class="COMM">//features = format.read(data.replace(/\n/g," ").slice(0,data.replace(/\n/g," ").lastIndexOf(" ")) +"\n");</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">        	</span><span class="NAME">features</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">format.read</span><span class="PUNC">(</span><span class="NAME">data.replace</span><span class="PUNC">(</span><span class="REGX">/\n/g</span><span class="PUNC">,</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">	        </span><span class="NAME">features</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">format.read</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1682</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"TXT"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="WHIT">        </span><span class="COMM">// TXT files will default to epsg:28992 / RD coordinates</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="WHIT">        </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">            </span><span class="NAME">externalProjection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="STRN">"EPSG:28992"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">            </span><span class="NAME">internalProjection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.map.baseLayer.projection</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">        </span><span class="NAME">format</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.Text</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">        </span><span class="NAME">format.defaultStyle.externalGraphic</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1690</span> </span><span class="WHIT">        </span><span class="NAME">features</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">format.read</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1691</span> </span><span class="WHIT">        </span><span class="COMM">// default OpenLayers.Text format uses 'title' as 'name' attribute</span><span class="WHIT">
<span class='line'>1692</span> </span><span class="WHIT">        </span><span class="COMM">// we add a 'name' attribute here</span><span class="WHIT">
<span class='line'>1693</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1694</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1695</span> </span><span class="WHIT">            </span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'name'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'title'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1696</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1697</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1698</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1699</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">'addFeaturesFromUrl aanroep met een niet ondersteund type: '</span><span class="PUNC">+</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1701</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">    </span><span class="COMM">// add styling to features</span><span class="WHIT">
<span class='line'>1703</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1704</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">feature</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">features</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1705</span> </span><span class="WHIT">        </span><span class="COMM">//console.log(feature);</span><span class="WHIT">
<span class='line'>1706</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'styletype'</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1707</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">styletype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">feature.attributes</span><span class="PUNC">[</span><span class="STRN">'styletype'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1708</span> </span><span class="WHIT">            </span><span class="COMM">// some formats (KML) return attr as objects instead of strings</span><span class="WHIT">
<span class='line'>1709</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">styletype</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1710</span> </span><span class="WHIT">                </span><span class="NAME">styletype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">styletype.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1711</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1712</span> </span><span class="WHIT">            </span><span class="NAME">feature.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="NAME">styletype</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1713</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1714</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">'KML'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.kmlstyles</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1715</span> </span><span class="WHIT">            </span><span class="COMM">// ok a KML layer containing styles</span><span class="WHIT">
<span class='line'>1716</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1717</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">==</span><span class="STRN">'TXT'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">feature.style.externalGraphic</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1718</span> </span><span class="WHIT">            </span><span class="COMM">//console.log('TXT feature WITH style:', feature.style);</span><span class="WHIT">
<span class='line'>1719</span> </span><span class="WHIT">            </span><span class="COMM">// this is a TXT feature with some style information</span><span class="WHIT">
<span class='line'>1720</span> </span><span class="WHIT">            </span><span class="COMM">// this is possible via the txturl parameter</span><span class="WHIT">
<span class='line'>1721</span> </span><span class="WHIT">            </span><span class="COMM">// in combination with OpenLayers.Format.Txt</span><span class="WHIT">
<span class='line'>1722</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1723</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1724</span> </span><span class="WHIT">            </span><span class="COMM">//console.log("feature WITHOUT style, adding some");</span><span class="WHIT">
<span class='line'>1725</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">feature.geometry.CLASS_NAME</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'OpenLayers.Geometry.Point'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1726</span> </span><span class="WHIT">                </span><span class="NAME">feature.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">'mt0'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1727</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1728</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">feature.geometry.CLASS_NAME</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'OpenLayers.Geometry.LineString'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1729</span> </span><span class="WHIT">                </span><span class="NAME">feature.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">'lt0'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1731</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">feature.geometry.CLASS_NAME</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'OpenLayers.Geometry.Polygon'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1732</span> </span><span class="WHIT">                </span><span class="NAME">feature.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">[</span><span class="STRN">'pt0'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1733</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1734</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1735</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1736</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">features.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1737</span> </span><span class="WHIT">        </span><span class="COMM">// mmm, no featues</span><span class="WHIT">
<span class='line'>1738</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">'Geen features aangemaakt. Is het formaat wel ok?\nU had gekozen voor het formaat: "'</span><span class="PUNC">+</span><span class="NAME">type</span><span class="PUNC">+</span><span class="STRN">'".\nRaadpleeg eventueel de help pagina\'s voor de juiste formaten.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1739</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1741</span> </span><span class="WHIT">    </span><span class="NAME">this.featuresLayer.addFeatures</span><span class="PUNC">(</span><span class="NAME">features</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1742</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">zoomToFeatures</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.featuresLayer.features.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1743</span> </span><span class="WHIT">        </span><span class="COMM">// zoom to dataextent</span><span class="WHIT">
<span class='line'>1744</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">totalFeaturesExtent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.featuresLayer.getDataExtent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1745</span> </span><span class="WHIT">        </span><span class="NAME">this.featuresLayer.map.zoomToExtent</span><span class="PUNC">(</span><span class="NAME">totalFeaturesExtent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1747</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1748</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1749</span> 
<span class='line'>1750</span> </span><span class="COMM">/**
<span class='line'>1751</span>  * Deleting all layers, visible baseLayer and both internal vector layers
<span class='line'>1752</span>  * featureLayer and LocationsLayer will never be deleted
<span class='line'>1753</span>  * @param {Boolean} nonVectorLayers delete all non-vector layers
<span class='line'>1754</span>  * @param {Boolean} VectorLayers delete all vector layers
<span class='line'>1755</span>  */</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="NAME">Pdok.Api.prototype.deleteLayers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nonVectorLayers</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vectorLayers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="WHIT">    </span><span class="COMM">// defaulting to always the nonVectorLayers and NOT the vectorLayer</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">    </span><span class="NAME">nonVectorLayers</span><span class="PUNC">?</span><span class="NAME">nonVectorLayers</span><span class="PUNC">:</span><span class="NAME">nonVectorLayers</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">    </span><span class="NAME">vectorLayers</span><span class="PUNC">?</span><span class="NAME">vectorLayers</span><span class="PUNC">:</span><span class="NAME">vectorLayers</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1760</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.map.layers.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1761</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.map.layers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer.isBaseLayer</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">layer.visibility</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">            </span><span class="COMM">// current visible baselayer: do NOT remove</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1765</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.featuresLayer</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.locationLayer</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer.CLASS_NAME</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'OpenLayers.Layer.Vector'</span><span class="WHIT"> 
<span class='line'>1767</span>                     </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vectorLayers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="WHIT">                </span><span class="NAME">this.map.removeLayer</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nonVectorLayers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1771</span> </span><span class="WHIT">                </span><span class="NAME">this.map.removeLayer</span><span class="PUNC">(</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1772</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1773</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1775</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1776</span> 
<span class='line'>1777</span> </span><span class="COMM">/**
<span class='line'>1778</span>  * Add features to the this.featuresLayer of the map via an URL and type
<span class='line'>1779</span>  * @param url {String} URL of either a text or a kml file to load
<span class='line'>1780</span>  * @param type {String} type, one of 'KML' or 'TXT'
<span class='line'>1781</span>  * @param {Boolean} zoomToFeatures boolean to determine if we should zoom to the extent of the just added features
<span class='line'>1782</span>  */</span><span class="WHIT">
<span class='line'>1783</span> </span><span class="NAME">Pdok.Api.prototype.addFeaturesFromUrl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">zoomToFeatures</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1784</span> 
<span class='line'>1785</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">apiObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1786</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1787</span> </span><span class="WHIT">    </span><span class="COMM">// little dirty way to pass type and zoomToFeatures:</span><span class="WHIT">
<span class='line'>1788</span> </span><span class="WHIT">    </span><span class="NAME">context.dataType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1789</span> </span><span class="WHIT">    </span><span class="NAME">context.zoomToFeatures</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">zoomToFeatures</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1790</span> 
<span class='line'>1791</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"KML"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1792</span> </span><span class="WHIT">        </span><span class="COMM">// kml</span><span class="WHIT">
<span class='line'>1793</span> </span><span class="WHIT">        </span><span class="NAME">this.kmlurl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1794</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1795</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">type.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"TXT"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1796</span> </span><span class="WHIT">        </span><span class="COMM">// tab separated txt file (in EPSG:28992)</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="WHIT">        </span><span class="COMM">// format (including header!)</span><span class="WHIT">
<span class='line'>1798</span> </span><span class="WHIT">        </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">        </span><span class="COMM">// point    title   description</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">        </span><span class="COMM">// 150000,350000  foo omschrijving foo</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">        </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1802</span> </span><span class="WHIT">        </span><span class="COMM">// OR</span><span class="WHIT">
<span class='line'>1803</span> </span><span class="WHIT">        </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>1804</span> </span><span class="WHIT">        </span><span class="COMM">// lat  lon title   description</span><span class="WHIT">
<span class='line'>1805</span> </span><span class="WHIT">        </span><span class="COMM">// 150000   350000    foo omschrijving foo</span><span class="WHIT">
<span class='line'>1806</span> </span><span class="WHIT">        </span><span class="NAME">this.txturl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1808</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1809</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">'addFeaturesFromUrl aanroep met een niet ondersteund type: '</span><span class="PUNC">+</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1810</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1811</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1812</span> </span><span class="WHIT">    </span><span class="NAME">OpenLayers.Request.GET</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1813</span> </span><span class="WHIT">            </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1814</span> </span><span class="WHIT">            </span><span class="NAME">callback</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">apiObject.handleGetFeaturesResponse</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1815</span> </span><span class="WHIT">            </span><span class="NAME">scope</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT">
<span class='line'>1816</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1817</span> 
<span class='line'>1818</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1819</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1820</span> 
<span class='line'>1821</span> </span><span class="COMM">/**
<span class='line'>1822</span>  * Shorthand to add KML features via a KML url (always zooming to the extent of the KML)
<span class='line'>1823</span>  */</span><span class="WHIT">
<span class='line'>1824</span> </span><span class="NAME">Pdok.Api.prototype.addKML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1825</span> </span><span class="WHIT">    </span><span class="NAME">this.addFeaturesFromUrl</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'KML'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1826</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1827</span> 
<span class='line'>1828</span> </span><span class="COMM">//Wellicht moet dit een andere call worden omdat nu een combinatie van txturl en mloc niet goed gaat</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="COMM">/**
<span class='line'>1830</span>  * Shorthand to add TXT features via a TXT url (always zooming to the extent of the TXT)
<span class='line'>1831</span>  */</span><span class="WHIT">
<span class='line'>1832</span> </span><span class="NAME">Pdok.Api.prototype.addTxt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1833</span> </span><span class="WHIT">    </span><span class="NAME">this.addFeaturesFromUrl</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'TXT'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1834</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1835</span> 
<span class='line'>1836</span> </span><span class="COMM">/**
<span class='line'>1837</span>  * Create the iframe tags string for this instance
<span class='line'>1838</span>  */</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="NAME">Pdok.Api.prototype.createIframeTags</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1840</span> </span><span class="WHIT">    </span><span class="COMM">// map div size</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mapSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1842</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iframeTags</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;iframe width="'</span><span class="PUNC">+</span><span class="NAME">mapSize.w</span><span class="PUNC">+</span><span class="STRN">'" height="'</span><span class="PUNC">+</span><span class="NAME">mapSize.h</span><span class="PUNC">+</span><span class="STRN">'" frameborder="0" scrolling=no marginheight="0" marginwidth="0" src="'</span><span class="PUNC">+</span><span class="NAME">this.createMapLink</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'" title="PDOK Kaart">&lt;/iframe>'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">iframeTags</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1845</span> 
<span class='line'>1846</span> </span><span class="COMM">/**
<span class='line'>1847</span>  * Create the object tags string for this instance
<span class='line'>1848</span>  */</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="NAME">Pdok.Api.prototype.createObjectTags</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1850</span> </span><span class="WHIT">    </span><span class="COMM">// map div size</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mapSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.map.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1852</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">objectTags</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;object width="'</span><span class="PUNC">+</span><span class="NAME">mapSize.w</span><span class="PUNC">+</span><span class="STRN">'" height="'</span><span class="PUNC">+</span><span class="NAME">mapSize.h</span><span class="PUNC">+</span><span class="STRN">'" codetype="text/html" data="'</span><span class="PUNC">+</span><span class="NAME">this.createMapLink</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'" title="PDOK Kaart">&lt;/object>'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">objectTags</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1854</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1855</span> 
<span class='line'>1856</span> </span><span class="COMM">/**
<span class='line'>1857</span>  * Create the link string for this instance
<span class='line'>1858</span>  */</span><span class="WHIT">
<span class='line'>1859</span> </span><span class="NAME">Pdok.Api.prototype.createMapLink</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1860</span> </span><span class="WHIT">	</span><span class="NAME">pathname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.pathname</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1861</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pathname.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">search</span><span class="PUNC">(</span><span class="STRN">"index.html"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1862</span> </span><span class="WHIT">    	</span><span class="NAME">pathname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.pathname.substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">window.location.pathname.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">search</span><span class="PUNC">(</span><span class="STRN">"index.html"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1863</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1864</span> </span><span class="WHIT">    </span><span class="NAME">base</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.host</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">pathname</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1865</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'http://'</span><span class="PUNC">+</span><span class="NAME">base</span><span class="PUNC">+</span><span class="STRN">'api/api.html?'</span><span class="PUNC">+</span><span class="NAME">OpenLayers.Util.getParameterString</span><span class="PUNC">(</span><span class="NAME">this.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1866</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1867</span> 
<span class='line'>1868</span> </span><span class="COMM">/**
<span class='line'>1869</span>  * Create the email link string for this instance
<span class='line'>1870</span>  */</span><span class="WHIT">
<span class='line'>1871</span> </span><span class="NAME">Pdok.Api.prototype.createMailLink</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1872</span> </span><span class="WHIT">	</span><span class="NAME">pathname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.pathname</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pathname.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">search</span><span class="PUNC">(</span><span class="STRN">"index.html"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1874</span> </span><span class="WHIT">    	</span><span class="NAME">pathname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.pathname.substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">window.location.pathname.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">search</span><span class="PUNC">(</span><span class="STRN">"index.html"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1875</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1876</span> </span><span class="WHIT">    </span><span class="NAME">base</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.host</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">pathname</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1877</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'mailto:UwMailAdres@provider.nl?Subject=PDOKKaart%20URL&BODY=URL%3A%20'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="STRN">'http://'</span><span class="PUNC">+</span><span class="NAME">base</span><span class="PUNC">+</span><span class="STRN">'api/api.html?'</span><span class="PUNC">+</span><span class="NAME">OpenLayers.Util.getParameterString</span><span class="PUNC">(</span><span class="NAME">this.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1878</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1879</span> 
<span class='line'>1880</span> </span><span class="COMM">/**
<span class='line'>1881</span>  * Create the html body string for this instance
<span class='line'>1882</span>  */</span><span class="WHIT">
<span class='line'>1883</span> </span><span class="NAME">Pdok.Api.prototype.createHtmlBody</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1884</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;div id="map">&lt;/div>\n'</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1885</span> </span><span class="WHIT">               </span><span class="STRN">'&lt;script>var  api = createPDOKKaart();\n'</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="WHIT">               </span><span class="STRN">'&lt;/script>'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1887</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">html</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1888</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1889</span> 
<span class='line'>1890</span> </span><span class="COMM">/**
<span class='line'>1891</span>  * Create the html head string for this instance
<span class='line'>1892</span>  */</span><span class="WHIT">
<span class='line'>1893</span> </span><span class="NAME">Pdok.Api.prototype.createHtmlHead</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1894</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">base</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Pdok.createBaseUri</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1895</span> </span><span class="WHIT">    </span><span class="COMM">// styles and layers definitions</span><span class="WHIT">
<span class='line'>1896</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stylesAndLayers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1897</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.markersdef</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1898</span> </span><span class="WHIT">        </span><span class="NAME">stylesAndLayers</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'\n&lt;script src="'</span><span class="PUNC">+</span><span class="NAME">this.markersdef</span><span class="PUNC">+</span><span class="STRN">'">&lt;/script>'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1899</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1900</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.layersdef</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1901</span> </span><span class="WHIT">        </span><span class="NAME">stylesAndLayers</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'\n&lt;script src="'</span><span class="PUNC">+</span><span class="NAME">this.layersdef</span><span class="PUNC">+</span><span class="STRN">'">&lt;/script>'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1902</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1903</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">head</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;script src="'</span><span class="PUNC">+</span><span class="NAME">base</span><span class="PUNC">+</span><span class="STRN">'api/js/OpenLayers.js">&lt;/script>'</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1904</span> </span><span class="WHIT">    </span><span class="STRN">'\n&lt;script src="'</span><span class="PUNC">+</span><span class="NAME">base</span><span class="PUNC">+</span><span class="STRN">'api/js/proj4js-compressed.js">&lt;/script>'</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1905</span> </span><span class="WHIT">    </span><span class="STRN">'\n&lt;script src="'</span><span class="PUNC">+</span><span class="NAME">base</span><span class="PUNC">+</span><span class="STRN">'api/js/pdok-api.js">&lt;/script>'</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1906</span> </span><span class="WHIT">    </span><span class="NAME">stylesAndLayers</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1907</span> </span><span class="WHIT">    </span><span class="STRN">'\n&lt;link rel="stylesheet" href="'</span><span class="PUNC">+</span><span class="NAME">base</span><span class="PUNC">+</span><span class="STRN">'api/styles/default/style.css" type="text/css">'</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1908</span> </span><span class="WHIT">    </span><span class="STRN">'\n&lt;link rel="stylesheet" href="'</span><span class="PUNC">+</span><span class="NAME">base</span><span class="PUNC">+</span><span class="STRN">'api/styles/api.css" type="text/css">'</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1909</span> </span><span class="WHIT">    </span><span class="STRN">'\n&lt;script>'</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1910</span> </span><span class="WHIT">    </span><span class="STRN">'\nOpenLayers.ImgPath="'</span><span class="PUNC">+</span><span class="NAME">Pdok.ApiUrl</span><span class="PUNC">+</span><span class="STRN">'/img/";'</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1911</span> </span><span class="WHIT">    </span><span class="STRN">'\nvar config = '</span><span class="PUNC">+</span><span class="NAME">this.serialize</span><span class="PUNC">(</span><span class="NAME">this.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">';\n'</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>1912</span> </span><span class="WHIT">    </span><span class="STRN">'\nfunction createPDOKKaart() {var api = new Pdok.Api(config);return api;}\n&lt;/script>'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1913</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">head</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1914</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1915</span> 
<span class='line'>1916</span> </span><span class="COMM">/**
<span class='line'>1917</span>  * Api call to get a config object which can be used to start an Api instance in current state
<span class='line'>1918</span>  */</span><span class="WHIT">
<span class='line'>1919</span> </span><span class="NAME">Pdok.Api.prototype.getConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">config</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1921</span> 
<span class='line'>1922</span> </span><span class="WHIT">    </span><span class="COMM">// zoom</span><span class="WHIT">
<span class='line'>1923</span> </span><span class="WHIT">    </span><span class="NAME">config.zoom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.map.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1924</span> </span><span class="WHIT">    </span><span class="COMM">// only add the LayerSwitcher parameter if false (default value is true)</span><span class="WHIT">
<span class='line'>1925</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.showlayerswitcher</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1926</span> </span><span class="WHIT">	    </span><span class="NAME">config.showlayerswitcher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.showlayerswitcher</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1927</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1928</span> </span><span class="WHIT">    </span><span class="COMM">// bbox</span><span class="WHIT">
<span class='line'>1929</span> </span><span class="WHIT">    </span><span class="COMM">// config.bbox = this.map.getExtent().toArray();</span><span class="WHIT">
<span class='line'>1930</span> </span><span class="WHIT">    </span><span class="COMM">// or better ? loc</span><span class="WHIT">
<span class='line'>1931</span> </span><span class="WHIT">    </span><span class="NAME">config.loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.map.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toShortString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1932</span> </span><span class="WHIT">    </span><span class="COMM">// layers</span><span class="WHIT">
<span class='line'>1933</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1934</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layer</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.map.layers</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1935</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pdokId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.map.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">pdokId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1936</span> </span><span class="WHIT">        </span><span class="COMM">// only layers with a pdokId, and NOT our this.featuresLayer</span><span class="WHIT">
<span class='line'>1937</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pdokId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.map.layers</span><span class="PUNC">[</span><span class="NAME">layer</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.FEATURESLAYER_NAME</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1938</span> </span><span class="WHIT">            </span><span class="NAME">layers.push</span><span class="PUNC">(</span><span class="NAME">pdokId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1939</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1940</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1941</span> </span><span class="WHIT">            </span><span class="COMM">// we have a layer from 'outside'</span><span class="WHIT">
<span class='line'>1942</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1943</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1944</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">layers.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1945</span> </span><span class="WHIT">        </span><span class="NAME">config.pdoklayers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">layers.join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1946</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1947</span> </span><span class="WHIT">    </span><span class="COMM">// wmsurl AND wmslayers</span><span class="WHIT">
<span class='line'>1948</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.wmsurl</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.wmsurl.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.wmslayers</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.wmslayers.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1949</span> </span><span class="WHIT">        </span><span class="NAME">config.wmsurl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.wmsurl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1950</span> </span><span class="WHIT">        </span><span class="NAME">config.wmslayers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.wmslayers</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1951</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1952</span> </span><span class="WHIT">    </span><span class="COMM">// wmts</span><span class="WHIT">
<span class='line'>1953</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.wmtsurl</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.wmtslayer</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.wmtsmatrixset</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> 
<span class='line'>1954</span>         </span><span class="NAME">this.wmtsurl.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.wmtslayer.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.wmtsmatrixset.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1955</span> </span><span class="WHIT">        </span><span class="NAME">config.wmtsurl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.wmtsurl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1956</span> </span><span class="WHIT">        </span><span class="NAME">config.wmtslayer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.wmtslayer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1957</span> </span><span class="WHIT">        </span><span class="NAME">config.wmtsmatrixset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.wmtsmatrixset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1958</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1959</span> </span><span class="WHIT">    </span><span class="COMM">// locationtool</span><span class="WHIT">
<span class='line'>1960</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.locationtool</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1961</span> </span><span class="WHIT">        </span><span class="NAME">config.locationtool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1962</span> </span><span class="WHIT">        </span><span class="NAME">config.locationtoolstyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.locationtoolstyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1963</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.locationtoolwktfield</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1964</span> </span><span class="WHIT">            </span><span class="NAME">config.locationtoolwktfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.locationtoolwktfield</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1965</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="WHIT">            </span><span class="NAME">config.locationtoolxfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.locationtoolxfield</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1968</span> </span><span class="WHIT">            </span><span class="NAME">config.locationtoolyfield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.locationtoolyfield</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1969</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1970</span> </span><span class="WHIT">        </span><span class="NAME">config.locationtoolzmin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.locationtoolzmin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1971</span> </span><span class="WHIT">        </span><span class="NAME">config.locationtoolzmax</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.locationtoolzmax</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1972</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1973</span> </span><span class="WHIT">    </span><span class="COMM">// markersdef</span><span class="WHIT">
<span class='line'>1974</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.markersdef</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1975</span> </span><span class="WHIT">        </span><span class="NAME">config.markersdef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.markersdef</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1976</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1977</span> </span><span class="WHIT">    </span><span class="COMM">// layersdef</span><span class="WHIT">
<span class='line'>1978</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.layersdef</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1979</span> </span><span class="WHIT">        </span><span class="NAME">config.layersdef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.layersdef</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1980</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1981</span> </span><span class="WHIT">    </span><span class="COMM">// kmlurl OR txturl OR features</span><span class="WHIT">
<span class='line'>1982</span> </span><span class="WHIT">    </span><span class="COMM">// at this moment NOT a combination of these two</span><span class="WHIT">
<span class='line'>1983</span> </span><span class="WHIT">    </span><span class="COMM">// all features from KML or TXT are added to 'featureslayer'</span><span class="WHIT">
<span class='line'>1984</span> </span><span class="WHIT">    </span><span class="COMM">// so if the user added even more markers/features</span><span class="WHIT">
<span class='line'>1985</span> </span><span class="WHIT">    </span><span class="COMM">// we should try to make a diff, to know which features to add in the features-kmlstring-parameter</span><span class="WHIT">
<span class='line'>1986</span> </span><span class="WHIT">    </span><span class="COMM">// but if the user has made changes by hand in wizard, it is getting even more comples</span><span class="WHIT">
<span class='line'>1987</span> </span><span class="WHIT">    </span><span class="COMM">// so for now: there is either a kmlurl and/or a txturl OR only features as parameter</span><span class="WHIT">
<span class='line'>1988</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.featuresLayer.features.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1989</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doFeatures</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1990</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.kmlurl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1991</span> </span><span class="WHIT">            </span><span class="NAME">config.kmlurl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.kmlurl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1992</span> </span><span class="WHIT">            </span><span class="NAME">doFeatures</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1993</span> </span><span class="WHIT">            </span><span class="COMM">// if kmlstyles</span><span class="WHIT">
<span class='line'>1994</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.kmlstyles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1995</span> </span><span class="WHIT">                </span><span class="NAME">config.kmlstyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1996</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1997</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1998</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.txturl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1999</span> </span><span class="WHIT">            </span><span class="NAME">config.txturl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.txturl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2000</span> </span><span class="WHIT">            </span><span class="NAME">doFeatures</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2001</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2002</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.mimg</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2003</span> </span><span class="WHIT">            </span><span class="NAME">config.mimg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mimg</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2004</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2005</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doFeatures</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">            </span><span class="COMM">// If only one feature is added and this is a point then use the parameter mloc</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.featuresLayer.features.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.featuresLayer.features</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">geometry.CLASS_NAME</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"OpenLayers.Geometry.Point"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2008</span> </span><span class="WHIT">            	</span><span class="NAME">config.mloc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.featuresLayer.features</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">geometry.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.featuresLayer.features</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">geometry.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2009</span> </span><span class="WHIT">            	</span><span class="NAME">config.titel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.featuresLayer.features</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">attributes.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2010</span> </span><span class="WHIT">            	</span><span class="NAME">config.tekst</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">this.featuresLayer.features</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">attributes.description</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2011</span> </span><span class="WHIT">            	</span><span class="NAME">config.mt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.featuresLayer.features</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">attributes.styletype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2012</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2013</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2014</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">kmlformat</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Format.KML</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2015</span> </span><span class="WHIT">					</span><span class="NAME">foldersDesc</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2016</span> </span><span class="WHIT">					</span><span class="NAME">foldersName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2017</span> </span><span class="WHIT">					</span><span class="NAME">placemarksDesc</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'&nbsp;'</span><span class="PUNC">,</span><span class="WHIT">   </span><span class="COMM">// we add &nbsp; here because null or '' will cause the KML writer to not see it as value</span><span class="WHIT">
<span class='line'>2018</span> </span><span class="WHIT">					</span><span class="NAME">internalProjection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.map.baseLayer.projection</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2019</span> </span><span class="WHIT">					</span><span class="NAME">externalProjection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenLayers.Projection</span><span class="PUNC">(</span><span class="STRN">"EPSG:4326"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2020</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2021</span> </span><span class="WHIT">				</span><span class="NAME">config.features</span><span class="PUNC">=</span><span class="NAME">kmlformat.write</span><span class="PUNC">(</span><span class="NAME">this.featuresLayer.features</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2022</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2023</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2024</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2025</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">config</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2026</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2027</span> 
<span class='line'>2028</span> </span><span class="COMM">/**
<span class='line'>2029</span>  * Method do serialize the config object to a json string
<span class='line'>2030</span>  * @private
<span class='line'>2031</span>  */</span><span class="WHIT">
<span class='line'>2032</span> </span><span class="NAME">Pdok.Api.prototype.serialize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">stringQuotes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2033</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">returnVal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2034</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">stringQuotes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">stringQuotes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">  </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">obj.constructor</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">   </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2039</span> </span><span class="WHIT">    </span><span class="COMM">//var vArr="[";</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vArr</span><span class="PUNC">=</span><span class="STRN">"'"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2041</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">obj.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">    </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">vArr</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">","</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2044</span> </span><span class="WHIT">     </span><span class="NAME">vArr</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.serialize</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2046</span> </span><span class="WHIT">    </span><span class="COMM">//vArr += "]"</span><span class="WHIT">
<span class='line'>2047</span> </span><span class="WHIT">    </span><span class="NAME">vArr</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"'"</span><span class="WHIT">
<span class='line'>2048</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vArr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="WHIT">   </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2050</span> </span><span class="WHIT">    </span><span class="NAME">returnVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2051</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">stringQuotes</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">        </span><span class="COMM">//returnVal = escape("'" + obj + "'");</span><span class="WHIT">
<span class='line'>2053</span> </span><span class="WHIT">        </span><span class="NAME">returnVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"'"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"'"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2054</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2055</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">returnVal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2056</span> </span><span class="WHIT">   </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2057</span> </span><span class="WHIT">    </span><span class="NAME">returnVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isFinite</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">obj.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2058</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">returnVal</span><span class="PUNC">;</span><span class="WHIT">    
<span class='line'>2059</span>    </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2060</span> </span><span class="WHIT">    </span><span class="NAME">returnVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"#"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"#"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2061</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">returnVal</span><span class="PUNC">;</span><span class="WHIT">  
<span class='line'>2062</span>    </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2063</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2064</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vobj</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2065</span> </span><span class="WHIT">     </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2066</span> </span><span class="WHIT">     </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2067</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">attr</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2068</span> </span><span class="WHIT">      </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2069</span> </span><span class="WHIT">       </span><span class="NAME">vobj.push</span><span class="PUNC">(</span><span class="STRN">'\n"'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'":'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.serialize</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">attr</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">stringQuotes</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2070</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2071</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2072</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">vobj.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2073</span> </span><span class="WHIT">       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"{"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vobj.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\n}"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2074</span> </span><span class="WHIT">      </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2075</span> </span><span class="WHIT">       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"{}"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2076</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">  
<span class='line'>2077</span>     </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2078</span> </span><span class="WHIT">    </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2079</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2080</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2081</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2082</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2083</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2084</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2085</span> 
<span class='line'>2086</span> </span><span class="COMM">/**
<span class='line'>2087</span>  * Function to toggle visibility of the OpenLayers.LayerSwitcher
<span class='line'>2088</span>  * @param {Boolean} isVisible to show the layer or not
<span class='line'>2089</span>  */</span><span class="WHIT">
<span class='line'>2090</span> </span><span class="NAME">Pdok.Api.prototype.setLayerSwitcherVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">isVisible</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2091</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isVisible</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2092</span> </span><span class="WHIT">        </span><span class="NAME">this.showlayerswitcher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2093</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2094</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2095</span> </span><span class="WHIT">        </span><span class="NAME">this.showlayerswitcher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2096</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2097</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2098</span> </span></pre></body></html>